(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    117671,       2696]
NotebookOptionsPosition[    107590,       2485]
NotebookOutlinePosition[    108041,       2502]
CellTagsIndexPosition[    107998,       2499]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Cell properties", "Section",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771091367329028*^9, 3.771091376051399*^9}, {
   3.7710914494997883`*^9, 3.771091449737112*^9}, {3.7713399557632*^9, 
   3.771339957449313*^9}, {3.771340052108297*^9, 3.771340052672747*^9}, {
   3.7713402634662113`*^9, 3.771340275092995*^9}, {3.7713405161007643`*^9, 
   3.7713405172042203`*^9}, 3.7713410305657473`*^9, {3.771955447344767*^9, 
   3.7719554498999057`*^9}, 3.772538758390728*^9, {3.772992345467865*^9, 
   3.772992345579595*^9}},ExpressionUUID->"31d44873-effb-441a-97bb-\
78de20879e79"],

Cell[CellGroupData[{

Cell["editing cell properties", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772886678242123*^9, 3.772886691536046*^9}, {
  3.7728868395831523`*^9, 
  3.772886839692607*^9}},ExpressionUUID->"ae715c53-d28e-4945-82c5-\
415b1db9cabf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Row", "[", 
    RowBox[{"#", ",", "\"\<    \>\""}], "]"}], "&"}], "@", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Row", "[", 
       RowBox[{"#", ",", "\"\<--->\>\""}], "]"}], "&"}], "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ActionMenu", "[", 
        RowBox[{"\"\<edit\>\"", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<edit = True\>\"", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"edit", "=", "True"}], ";"}], ")"}]}], ",", 
           RowBox[{"\"\<edit = False\>\"", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"edit", "=", "False"}], ";"}], ")"}]}]}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"Dynamic", "[", "edit", "]"}]}], "}"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Row", "[", 
       RowBox[{"#", ",", "\"\<--->\>\""}], "]"}], "&"}], "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ActionMenu", "[", 
        RowBox[{"\"\<delete\>\"", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<delete = True\>\"", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"delete", "=", "True"}], ";"}], ")"}]}], ",", 
           RowBox[{"\"\<delete = False\>\"", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"delete", "=", "False"}], ";"}], ")"}]}]}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"Dynamic", "[", "delete", "]"}]}], "}"}]}]}], "}"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.772538682999604*^9, 3.772538705697636*^9}, {
   3.7725388800906677`*^9, 3.77253888391788*^9}, {3.772538923939741*^9, 
   3.772538935309448*^9}, {3.772539194163709*^9, 3.772539353761448*^9}, {
   3.7725400809963293`*^9, 3.7725401540134783`*^9}, 3.7725403428318186`*^9, {
   3.772558282313302*^9, 3.772558299449335*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"cd94e952-7a67-4721-8627-59907ae90e65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cnnnb", "=", 
   RowBox[{"EvaluationNotebook", "[", "]"}]}], ";"}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.772538577538379*^9, 3.7725386199839873`*^9}, {
  3.772561259726162*^9, 3.772561268849103*^9}, {3.772561320736054*^9, 
  3.772561325953581*^9}, {3.830432408422649*^9, 3.830432416905243*^9}, {
  3.9646974127005444`*^9, 3.9646974276406784`*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"393438be-77f4-48ec-b621-8986cbb3dcba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"inputcells", "=", 
   RowBox[{"NotebookFind", "[", 
    RowBox[{"cnnnb", ",", "\"\<Input\>\"", ",", "All", ",", "CellStyle", ",", 
     RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"inputcells", ",", 
    RowBox[{"Evaluatable", "\[Rule]", "True"}], ",", 
    RowBox[{"Editable", "\[Rule]", "edit"}], ",", 
    RowBox[{"Deletable", "\[Rule]", "delete"}]}], "]"}], ";"}]}], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771338808327732*^9, 3.771338838774293*^9}, {
   3.771338872744232*^9, 3.771338901557121*^9}, {3.771339034391318*^9, 
   3.771339063783631*^9}, {3.771339096151359*^9, 3.77133911357322*^9}, {
   3.7713391442197604`*^9, 3.771339195676179*^9}, 3.771339390495008*^9, {
   3.771339575119819*^9, 3.77133960170828*^9}, {3.771339739830652*^9, 
   3.771339753379721*^9}, {3.771339783839568*^9, 3.771339793445896*^9}, {
   3.771339833663968*^9, 3.771339946755887*^9}, {3.771340040454396*^9, 
   3.7713400465261693`*^9}, {3.771340259874557*^9, 3.771340271029802*^9}, {
   3.7713410257249985`*^9, 3.771341027165447*^9}, {3.771606733315581*^9, 
   3.771606787720738*^9}, {3.771606856897359*^9, 3.771606858779351*^9}, {
   3.7716072150920186`*^9, 3.771607308401827*^9}, {3.771947641014653*^9, 
   3.771947658952503*^9}, {3.771947728649555*^9, 3.771947738700951*^9}, {
   3.771954299562523*^9, 3.77195430125387*^9}, {3.771954364975469*^9, 
   3.771954381379567*^9}, {3.771954527937702*^9, 3.771954530200677*^9}, {
   3.77195470540431*^9, 3.7719547066070895`*^9}, {3.77195489796051*^9, 
   3.771954915845731*^9}, {3.771955207646293*^9, 3.771955213175476*^9}, {
   3.7719553031320677`*^9, 3.77195541435301*^9}, {3.771955485493906*^9, 
   3.771955507270805*^9}, {3.771955615850394*^9, 3.771955652370714*^9}, {
   3.77195568965801*^9, 3.7719556917224617`*^9}, {3.772538628388029*^9, 
   3.77253862871608*^9}, {3.7725387108370686`*^9, 3.772538722818409*^9}, 
   3.772540335851931*^9, 3.9646974357603607`*^9},
 CellLabel->"In[88]:=",ExpressionUUID->"9c200a65-5f0a-430b-867f-39baac0ace8c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"sectioncells", "=", 
   RowBox[{"NotebookFind", "[", 
    RowBox[{
    "cnnnb", ",", "\"\<Section\>\"", ",", "All", ",", "CellStyle", ",", 
     RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"sectioncells", ",", 
    RowBox[{"Evaluatable", "\[Rule]", "False"}], ",", 
    RowBox[{"Editable", "\[Rule]", "edit"}], ",", 
    RowBox[{"Deletable", "\[Rule]", "delete"}]}], "]"}], ";"}]}], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.77195551243602*^9, 3.771955518776033*^9}, 
   3.771955628221305*^9, 3.7719556973643703`*^9, {3.772538632356098*^9, 
   3.772538632684143*^9}, {3.772538725708537*^9, 3.772538731660059*^9}, 
   3.9646974379475803`*^9},
 CellLabel->"In[90]:=",ExpressionUUID->"c849884c-1ef4-4160-a0fa-ba16c06e690e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"subsectioncells", "=", 
   RowBox[{"NotebookFind", "[", 
    RowBox[{
    "cnnnb", ",", "\"\<Subsection\>\"", ",", "All", ",", "CellStyle", ",", 
     RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"subsectioncells", ",", 
    RowBox[{"Evaluatable", "\[Rule]", "False"}], ",", 
    RowBox[{"Editable", "\[Rule]", "edit"}], ",", 
    RowBox[{"Deletable", "\[Rule]", "delete"}]}], "]"}], ";"}]}], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771955395965189*^9, 3.771955399206523*^9}, {
   3.771955522226803*^9, 3.771955528625688*^9}, 3.771955632052058*^9, 
   3.771955700198789*^9, {3.772538634372338*^9, 3.772538634641591*^9}, {
   3.7725387345536785`*^9, 3.77253873822447*^9}, {3.772538795105706*^9, 
   3.772538801026188*^9}, 3.964697439850134*^9},
 CellLabel->"In[92]:=",ExpressionUUID->"e08d260f-e4e1-4daf-870d-c7bf43484107"]
}, Closed]],

Cell[CellGroupData[{

Cell["history length", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772886678242123*^9, 
  3.772886704067807*^9}},ExpressionUUID->"69f13470-c74d-4498-ae19-\
1f60a787a498"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";"}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 InitializationCell->True,
 CellChangeTimes->{{3.771339235100431*^9, 3.771339241380398*^9}, 
   3.77133960432326*^9, 3.771947740365743*^9, {3.83034862192086*^9, 
   3.830348622018442*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"501fcad8-3315-4650-8d2c-0f5ce9e7268f"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Training CNN", "Section",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771091367329028*^9, 3.771091376051399*^9}, {
   3.7710914494997883`*^9, 3.771091449737112*^9}, {3.7713399557632*^9, 
   3.771339957449313*^9}, {3.771340052108297*^9, 3.771340052672747*^9}, {
   3.7713402634662113`*^9, 3.771340275092995*^9}, {3.7713405161007643`*^9, 
   3.7713405172042203`*^9}, 3.7713410305657473`*^9, 3.7719555534163847`*^9, {
   3.772799853866021*^9, 3.772799860357677*^9}, {3.772983716037102*^9, 
   3.772983718338978*^9}, {3.772992277395816*^9, 3.7729922783053846`*^9}, {
   3.964698043041411*^9, 3.9646980445985413`*^9}, {3.9748157035379753`*^9, 
   3.974815720499674*^9}, 
   3.974816003851547*^9},ExpressionUUID->"ba51696a-19fb-4322-afb5-\
95379d68e6ad"],

Cell[CellGroupData[{

Cell["importing training images", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772540308376088*^9, 3.772540310297519*^9}, {
  3.772540369535231*^9, 3.772540370394173*^9}, {3.77556540448072*^9, 
  3.775565416352929*^9}, {3.9646978799456406`*^9, 3.964697880685034*^9}, {
  3.974816024377735*^9, 
  3.9748160428027515`*^9}},ExpressionUUID->"0df258a7-09fa-438f-aa5b-\
fc461b98f583"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Importing", " ", "data", " ", "sets"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"imptdata", ",", "imgname"}], "}"}], "=", 
      RowBox[{"importDataset", "[", 
       RowBox[{"Dataset", "[", 
        RowBox[{"Association", "@@", "trainingdatasets"}], "]"}], "]"}]}], 
     ";"}], "//", "AbsoluteTiming"}], "\[IndentingNewLine]", 
   RowBox[{"dataMetrics", "[", "imptdata", "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.775564664741593*^9, 3.775564762710952*^9}, {
   3.775564803791711*^9, 3.775564809415404*^9}, {3.775564868805584*^9, 
   3.775564869945699*^9}, {3.775565266316674*^9, 3.7755652930604153`*^9}, 
   3.775565618990182*^9, {3.775567511113208*^9, 3.775567518017795*^9}, 
   3.775572656813044*^9, {3.7755728571686897`*^9, 3.77557292921122*^9}, {
   3.7755730554083276`*^9, 3.775573060485489*^9}, {3.775574648787916*^9, 
   3.7755746742512684`*^9}, 3.7758255629950275`*^9, 3.775825708379611*^9, 
   3.775827380453244*^9, {3.828803534641589*^9, 3.8288035525836287`*^9}, 
   3.964710198056658*^9, {3.964713995667147*^9, 3.964714003832505*^9}, {
   3.967817102558462*^9, 3.967817133685398*^9}, {3.96781761481793*^9, 
   3.967817615163374*^9}, {3.967818196282667*^9, 3.9678182258444633`*^9}, 
   3.9766406748366942`*^9},
 CellLabel->"In[11]:=",ExpressionUUID->"25cba8f5-3c4f-4ab0-b8ef-610401d8cef0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Formatting", " ", "data", " ", "and", " ", "applying", " ", "the", " ", 
      "new", " ", "class", " ", "index", " ", "values", " ", "if", " ", 
      "classindexchange"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"\"\<yes\>\"", ".", " ", "This"}], " ", "function", " ", 
      "first", " ", "normalizes", " ", "the", " ", "ground", " ", "truth", 
      " ", "pixel", " ", "values", " ", "to", " ", "lie", " ", "between", " ",
       "0", " ", "and", " ", "1"}]}], ",", " ", 
    RowBox[{
    "then", " ", "the", " ", "newclassindex", " ", "rule", " ", "is", " ", 
     RowBox[{"applied", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"imptdatamod", "=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"classindexchange", "\[Equal]", "\"\<yes\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "formatdata", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"formatdata", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{"formatFunc", ",", "imptdata", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "/.", "#2"}]}], "}"}], "&"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"formatdata", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"First", "[", "newclassindex", "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Length", "[", "formatdata", "]"}], "}"}]}], "]"}]}], 
            "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"formatFunc", ",", "imptdata", ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", "1"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.775565994412087*^9, 3.7755660008480663`*^9}, {
   3.775566073241833*^9, 3.775566153895038*^9}, {3.775566228700697*^9, 
   3.7755662826594*^9}, {3.775566384964616*^9, 3.7755664112709312`*^9}, {
   3.775568039162335*^9, 3.7755680647262106`*^9}, {3.775568151175197*^9, 
   3.7755681554866657`*^9}, {3.7755691841821585`*^9, 3.775569198116185*^9}, {
   3.7755694180531735`*^9, 3.775569465267918*^9}, {3.775569827762257*^9, 
   3.775569829824519*^9}, 3.7755731510687237`*^9, {3.82881089312759*^9, 
   3.828810893292316*^9}, 3.8637070178648214`*^9, {3.863707162225952*^9, 
   3.8637071656758766`*^9}, 3.863707665196879*^9, {3.863707798167856*^9, 
   3.863707798904016*^9}, {3.8637079391356783`*^9, 3.86370794727842*^9}, 
   3.94655455121929*^9, {3.946555749982384*^9, 3.946555765542187*^9}, {
   3.946555814671129*^9, 3.9465558226174355`*^9}, {3.946555907396631*^9, 
   3.9465559521260986`*^9}, {3.9465561578722706`*^9, 
   3.9465561737005463`*^9}, {3.964710481112263*^9, 3.964710494560541*^9}, {
   3.964710727161867*^9, 3.964710745066279*^9}, {3.964714012967287*^9, 
   3.964714066549456*^9}, {3.967817768820296*^9, 3.967817769370032*^9}, {
   3.976711865922655*^9, 3.9767119642561684`*^9}, {3.976712312109644*^9, 
   3.976712316045246*^9}},ExpressionUUID->"bcd0adbf-2571-4512-8789-\
e3f43f57abeb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Displaying", " ", "class", " ", "count", " ", "for", " ", "each", " ", 
    "training", " ", 
    RowBox[{"image", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"classcount", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sort", "@", 
         RowBox[{"Tally", "@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "&"}], ",", 
       "imptdatamod", ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"TableForm", "[", 
    RowBox[{"classcount", ",", 
     RowBox[{"TableDepth", "->", "2"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.9465554070169334`*^9, 3.9465554605069447`*^9}, {
  3.946555503072073*^9, 3.946555653384775*^9}, {3.94655623859388*^9, 
  3.9465562702996273`*^9}, {3.9647104402870216`*^9, 3.9647104616740875`*^9}, {
  3.9678178397889576`*^9, 3.967817864397549*^9}, {3.967817903853891*^9, 
  3.967817904026827*^9}, {3.9767120593146114`*^9, 
  3.9767120705500126`*^9}},ExpressionUUID->"936c6edd-d76b-8b4b-aa7d-\
6fc8c8383044"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Evaluate", " ", "this", " ", "line", " ", "to", " ", "visualy", " ", 
    "verify", " ", "that", " ", "each", " ", "image", " ", "is", " ", 
    "correctly", " ", "paired", " ", "with", " ", "its", " ", "corresponding",
     " ", "ground", " ", "truth", " ", "image", " ", "or", " ", 
    RowBox[{"array", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"displ1", "=", 
      RowBox[{"showFunc", "[", 
       RowBox[{"imptdatamod", ",", "colrules"}], "]"}]}], ";"}], "//", 
    "AbsoluteTiming"}], "\[IndentingNewLine]", 
   RowBox[{"Manipulate", "[", 
    RowBox[{
     RowBox[{"displ1", "[", 
      RowBox[{"[", "i", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "displ1", "]"}], ",", "1"}], "}"}], ",", 
     RowBox[{"ControlPlacement", "->", "Top"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.828810883722211*^9, 3.828810899157745*^9}, {
   3.830346635276374*^9, 3.830346734647007*^9}, 3.8303468596531367`*^9, {
   3.8303472710098667`*^9, 3.830347278776752*^9}, {3.830347874942268*^9, 
   3.830347877123642*^9}, {3.830348449794419*^9, 3.830348450146807*^9}, 
   3.830350463766122*^9, {3.863707700096896*^9, 3.863707701717396*^9}, {
   3.863708116426008*^9, 3.863708121283484*^9}, {3.86370866988278*^9, 
   3.863708673556183*^9}, {3.863708804878819*^9, 3.863708809417471*^9}, {
   3.8720001585568*^9, 3.872000159159309*^9}, {3.964710889564854*^9, 
   3.964710889878918*^9}, {3.9647109292845936`*^9, 3.964710949851044*^9}, 
   3.9647110193734226`*^9, {3.964712828924376*^9, 3.964712872193014*^9}, {
   3.964712931559263*^9, 3.9647129374735165`*^9}, {3.9647130699734745`*^9, 
   3.9647130798489285`*^9}, {3.965307415574686*^9, 3.965307435892599*^9}, {
   3.965307562960087*^9, 3.965307566324745*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"df3d0f47-e28a-4fd2-8658-4c63e5acaeac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Evaluate", " ", "this", " ", "line", " ", "to", " ", "check", " ", "the", 
    " ", "quality", " ", "of", " ", "the", " ", "training", " ", 
    RowBox[{"images", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"hlimg1", "=", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"HighlightImage", "[", 
         RowBox[{"#1", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"EdgeForm", "[", "]"}], ",", 
            RowBox[{"Image", "@", "#2"}]}], "}"}], ",", 
          RowBox[{"ImageSize", "->", "800"}]}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"imptdatamod", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"imptdatamod", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fn", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Values", "[", "imgname", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Manipulate", "[", 
    RowBox[{
     RowBox[{"dragZoomShow", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"overlay", "===", "True"}], ",", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"hlimg1", "[", 
           RowBox[{"[", "k", "]"}], "]"}], ",", 
          RowBox[{"PlotLabel", "->", 
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"fn", "[", 
              RowBox[{"[", "k", "]"}], "]"}], ",", "Red", ",", "16"}], 
            "]"}]}]}], "]"}], ",", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"imptdatamod", "[", 
           RowBox[{"[", 
            RowBox[{"k", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"PlotLabel", "->", 
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"fn", "[", 
              RowBox[{"[", "k", "]"}], "]"}], ",", "Red", ",", "16"}], 
            "]"}]}]}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", 
       RowBox[{"Length", "[", "hlimg1", "]"}], ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"overlay", ",", 
       RowBox[{"{", 
        RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{
  3.964872683352733*^9, {3.964873096324705*^9, 3.964873163216837*^9}, {
   3.964873571701535*^9, 3.964873592695219*^9}, {3.964873634396288*^9, 
   3.964873711804058*^9}, {3.964873764574112*^9, 3.964873776652975*^9}, 
   3.9651446055560665`*^9, {3.9651447074997253`*^9, 3.9651447331039257`*^9}, 
   3.9651450964321213`*^9, {3.965210211125698*^9, 3.965210256477194*^9}, 
   3.965210294558229*^9, {3.965210341678314*^9, 3.965210342181654*^9}, 
   3.967818505562077*^9},
 CellLabel->"In[26]:=",ExpressionUUID->"cd5d9996-ff7e-534c-abb7-dc481009d558"]
}, Closed]],

Cell[CellGroupData[{

Cell["formatting ground truth images", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772542514091657*^9, 
  3.7725425229960556`*^9}},ExpressionUUID->"e1f4fa57-c4ed-491f-abc5-\
cbd4b32a483e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Maximum", " ", "image", " ", "dimension", " ", "from", " ", "imported", 
    " ", 
    RowBox[{"dataset", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"maximgdim", "=", 
   RowBox[{"Max", "@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{"ImageDimensions", ",", 
        RowBox[{"imptdata", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], ",", "1"}], "]"}]}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.967820993364254*^9, 3.96782103683794*^9}, {
  3.967821222813284*^9, 3.967821237441324*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"a3fabd4a-0b43-5841-a83d-c63dd19f60f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Select", " ", "one", " ", "of", " ", "these", " ", "values", " ", "to", 
    " ", "use", " ", "as", " ", "the", " ", "network", " ", "input", " ", 
    "image", " ", 
    RowBox[{"dimension", ".", " ", "Enter"}], " ", "this", " ", "value", " ", 
    "into", " ", "netinpudim", " ", "variable", " ", "in", " ", "the", " ", 
    "parameter", " ", 
    RowBox[{"file", ".", " ", "Select"}], " ", "a", " ", "value", " ", "that",
     " ", "will", " ", "use", " ", "most", " ", "of", " ", "your", " ", 
    RowBox[{"machine", "'"}], "s", " ", "available", " ", "VRAM", " ", "but", 
    " ", "does", " ", "not", " ", "exceed", " ", 
    RowBox[{"it", ".", " ", "I"}], " ", "typically", " ", "determined", " ", 
    "this", " ", "by", " ", "trial", " ", "and", " ", 
    RowBox[{"error", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"inputdims", "=", 
   RowBox[{"imputDimSelect", "[", "1000", "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.967821042557114*^9, 3.967821043060063*^9}, {
  3.9678210833241653`*^9, 3.967821215583542*^9}, {3.976716571149723*^9, 
  3.9767166090799866`*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"56a59599-03df-6543-b31f-6ec14c746738"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Prints", " ", "out", " ", "the", " ", "image", " ", "partitioning", " ", 
    RowBox[{"parameters", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"imgparams", "=", 
   RowBox[{"imgPadandOffset", "[", 
    RowBox[{"maximgdim", ",", "n", ",", "netinputdim", ",", "0"}], 
    "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.967823466447796*^9, 3.9678234837439747`*^9}, {
  3.967908283356039*^9, 3.967908287429364*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"00ccc7a7-73b2-b34f-9c28-40f363d9e843"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Partitioning", " ", "training", " ", "images", " ", "into", " ", 
      "sub"}], "-", 
     RowBox[{"images", " ", "using", " ", "the", " ", "computed", " ", 
      RowBox[{"imgparams", ".", " ", "If"}], " ", "augmentation", " ", "is", 
      " ", "\"\<yes\>\"", " ", "the", " ", "total", " ", "number", " ", "of", 
      " ", "images", " ", "in", " ", "subimages", " ", "without", " ", 
      "filtering", " ", "would", " ", "be", " ", "5", "*", 
      RowBox[{"Length", "[", "imptdatamod", "]"}], "*", 
      RowBox[{"n", "^", "2"}]}]}], ",", " ", 
    RowBox[{
    "the", " ", "number", " ", "5", " ", "accounts", " ", "for", " ", "the", 
     " ", "data", " ", "augmentation", " ", "factor"}], ",", " ", 
    RowBox[{
    "if", " ", "filtering", " ", "is", " ", "\"\<yes\>\"", " ", "it", " ", 
     "could", " ", "lower", " ", "the", " ", "number", " ", "of", " ", 
     "training", " ", 
     RowBox[{"images", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"subimages", "=", "\[IndentingNewLine]", 
      RowBox[{"evaluatorFunc", "[", 
       RowBox[{
       "imptdatamod", ",", "imgparams", ",", "filtering", ",", 
        "augmentation"}], "]"}]}], ";"}], "//", "AbsoluteTiming"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Tally", "[", 
    RowBox[{"Apply", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ImageDimensions", "[", "#1", "]"}], ",", 
         RowBox[{"Dimensions", "[", "#2", "]"}]}], "}"}], "&"}], ",", 
      "subimages", ",", 
      RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7725436390610137`*^9, 3.772543767624003*^9}, {
   3.772543896466843*^9, 3.7725438979157305`*^9}, {3.772548316524578*^9, 
   3.7725483384405775`*^9}, {3.7725488483782997`*^9, 
   3.7725488629467244`*^9}, {3.772549720144746*^9, 3.772549723693016*^9}, {
   3.7725499769474154`*^9, 3.7725499815724955`*^9}, {3.772551368013875*^9, 
   3.77255137018884*^9}, {3.7725548741133122`*^9, 3.772554877855667*^9}, {
   3.7725549204350824`*^9, 3.772554941465413*^9}, 3.772572896169871*^9, {
   3.772801503802141*^9, 3.77280152763505*^9}, {3.7728016045703955`*^9, 
   3.7728016191770225`*^9}, {3.772816511661897*^9, 3.772816520764908*^9}, {
   3.772993359365221*^9, 3.772993360885191*^9}, {3.772998071855693*^9, 
   3.772998072831375*^9}, {3.7734191205566196`*^9, 3.773419122672935*^9}, {
   3.775566541822014*^9, 3.775566548320462*^9}, {3.967823503020359*^9, 
   3.967823519936621*^9}, 3.967824146938992*^9, {3.967892270614889*^9, 
   3.967892341924395*^9}, {3.96789242470767*^9, 3.9678924527548714`*^9}, {
   3.967908309930352*^9, 3.967908340825587*^9}, 3.976716367640024*^9, {
   3.9767164338419666`*^9, 3.9767164340616817`*^9}, {3.9767240406970177`*^9, 
   3.9767240511598854`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"10ec0547-b76f-4063-ac11-555c5cd95515"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Make", " ", "sure", " ", "there", " ", "is", " ", "correspondence", " ", 
    "in", " ", "the", " ", "partition", " ", "data", " ", "between", " ", 
    "the", " ", "input", " ", "images", " ", "and", " ", "ground", " ", 
    RowBox[{"truth", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"viewTrainingImgs", "[", 
   RowBox[{"subimages", ",", "colrules"}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7725499170164986`*^9, 3.77254993542513*^9}, {
   3.77255254606291*^9, 3.7725525555521355`*^9}, {3.772554651252542*^9, 
   3.772554651901231*^9}, {3.772554881957653*^9, 3.772554885573391*^9}, {
   3.772556228439249*^9, 3.7725562296904755`*^9}, {3.772557201013312*^9, 
   3.7725572030353155`*^9}, {3.772560288869875*^9, 3.7725602906051035`*^9}, {
   3.7728014531921625`*^9, 3.7728014767919855`*^9}, {3.7729964275035*^9, 
   3.7729964302151113`*^9}, {3.77342159148366*^9, 3.77342160016566*^9}, {
   3.775566472807134*^9, 3.775566473135089*^9}, 3.828811002322791*^9, 
   3.829665793096515*^9, {3.830350957102683*^9, 3.830351024830632*^9}, 
   3.9767240696678925`*^9},
 CellLabel->"In[96]:=",ExpressionUUID->"ab8f7267-245f-4a36-b576-f9af129e2215"]
}, Closed]],

Cell[CellGroupData[{

Cell["splitting data into training, validation, and testing sets", \
"Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772542514091657*^9, 3.7725425229960556`*^9}, {
  3.772557980490297*^9, 3.7725579867805223`*^9}, {3.787490248966664*^9, 
  3.787490257216126*^9}, {3.967824482265929*^9, 
  3.967824496832756*^9}},ExpressionUUID->"4ed86300-6a56-46b2-9489-\
f9f9bf9f074b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Splitting", " ", "the", " ", "data", " ", "into", " ", "training"}], ",",
     " ", "validation", ",", " ", 
    RowBox[{"and", " ", "test", " ", 
     RowBox[{"categories", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"traindata", ",", "valdata", ",", "testdata"}], "}"}], "=", 
     RowBox[{"splitData", "[", 
      RowBox[{
      "subimages", ",", "fraction1", ",", "fraction2", ",", "fraction3", ",", 
       "seednumber"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Map", "[", 
    RowBox[{"Length", ",", 
     RowBox[{"{", 
      RowBox[{"traindata", ",", "valdata", ",", "testdata"}], "}"}]}], 
    "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.787576955782045*^9, 3.787576964734553*^9}, {
   3.787577007637819*^9, 3.787577037588865*^9}, {3.967892379958227*^9, 
   3.967892395843096*^9}, 3.9767240919801445`*^9},
 CellLabel->"In[97]:=",ExpressionUUID->"bb69c5f8-4f86-483f-b6f4-f0e3d4f12282"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Formatting", " ", "data", " ", "for", " ", 
    RowBox[{"training", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"traindatmod", ",", "valdatmod"}], "}"}], "=", 
       RowBox[{"trainingDataFunc", "[", 
        RowBox[{"traindata", ",", "valdata"}], "]"}]}], ";"}], "//", 
     "Quiet"}], "//", "AbsoluteTiming"}], "\[IndentingNewLine]", 
   RowBox[{"Map", "[", 
    RowBox[{"Dimensions", ",", 
     RowBox[{"{", 
      RowBox[{"traindatmod", ",", "valdatmod"}], "}"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7710795043462133`*^9, 3.7710795380438757`*^9}, {
   3.7710795755725455`*^9, 3.77107961209758*^9}, {3.771081614847408*^9, 
   3.7710816835627403`*^9}, {3.7710834306496277`*^9, 3.771083434638965*^9}, {
   3.771084007671761*^9, 3.771084012611557*^9}, {3.771717562868557*^9, 
   3.77171756317846*^9}, {3.771717597464202*^9, 3.771717598471749*^9}, {
   3.771950850615233*^9, 3.771950888491474*^9}, {3.771950931303965*^9, 
   3.771950950241314*^9}, 3.771950984937515*^9, {3.771951206273718*^9, 
   3.771951211841435*^9}, {3.771951255442291*^9, 3.771951269396974*^9}, {
   3.771952414591835*^9, 3.771952414675607*^9}, {3.771952568427571*^9, 
   3.771952586369587*^9}, {3.771953070100797*^9, 3.7719530707241297`*^9}, {
   3.771953122347029*^9, 3.77195312243579*^9}, {3.771954220749687*^9, 
   3.77195422549699*^9}, 3.771954292555502*^9, {3.772213908226441*^9, 
   3.77221390888568*^9}, {3.772213949218843*^9, 3.7722141281735077`*^9}, {
   3.772214245437069*^9, 3.772214258471232*^9}, {3.772222446100025*^9, 
   3.77222251323364*^9}, 3.7722227152211285`*^9, 3.77222359391963*^9, 
   3.772465576035634*^9, 3.772558126606134*^9, {3.77255831621306*^9, 
   3.772558325101764*^9}, {3.772558402356026*^9, 3.772558444908516*^9}, {
   3.7725588589606876`*^9, 3.772558905108815*^9}, 3.772559023601573*^9, {
   3.772559062123825*^9, 3.772559085916459*^9}, {3.7725592846356826`*^9, 
   3.772559323743618*^9}, {3.772559410339268*^9, 3.772559414213134*^9}, {
   3.7725595171266985`*^9, 3.7725595885036917`*^9}, {3.772559623275664*^9, 
   3.7725596423959684`*^9}, {3.7725597069142866`*^9, 
   3.7725598030795574`*^9}, {3.7725598739379206`*^9, 3.772559936053614*^9}, {
   3.772560005056834*^9, 3.772560018272739*^9}, {3.772560049718499*^9, 
   3.772560094040077*^9}, {3.7725606517552805`*^9, 3.772560655160935*^9}, {
   3.7725761374529285`*^9, 3.77257613938582*^9}, {3.77257705154508*^9, 
   3.772577053562301*^9}, {3.7725776001686974`*^9, 3.772577601937625*^9}, {
   3.772801355971285*^9, 3.772801427588231*^9}, {3.772801482100882*^9, 
   3.77280149032096*^9}, {3.7729829156135187`*^9, 3.772982974204218*^9}, 
   3.773419297159467*^9, 3.7734203668801055`*^9, {3.7734216091736035`*^9, 
   3.773421632267021*^9}, {3.775569620912979*^9, 3.775569621319132*^9}, {
   3.775572256746128*^9, 3.775572259329203*^9}, 3.787490273136907*^9, {
   3.787508506052298*^9, 3.787508512895573*^9}, {3.787574856352641*^9, 
   3.787574858258747*^9}, {3.787576886958694*^9, 3.787576911910084*^9}, 
   3.787577092569414*^9, {3.787577307616989*^9, 3.787577316897559*^9}, {
   3.947254827595604*^9, 3.947254828440352*^9}, 3.9678243249686184`*^9, 
   3.967824420652447*^9, {3.967892399967579*^9, 3.96789241178368*^9}},
 CellLabel->"In[99]:=",ExpressionUUID->"f2b0e368-6253-4f2b-911e-7f921111dcfb"]
}, Closed]],

Cell[CellGroupData[{

Cell["training network", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772885705728381*^9, 3.772885714788514*^9}, {
  3.772886720829717*^9, 
  3.772886720876581*^9}},ExpressionUUID->"9dad18ab-ba08-406e-acde-\
95926f384d63"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Importing", " ", "CNN"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"networktotrain", "=", "\[IndentingNewLine]", 
   RowBox[{"Which", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"useprevtrainednet", "\[Equal]", "\"\<yes\>\""}], ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"lossLayer", "[", 
      RowBox[{"Import", "[", "prevtrainednet", "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"useprevtrainednet", "\[Equal]", "\"\<no\>\""}], ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"impCNN", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"First", "@", 
         RowBox[{"FileNames", "[", 
          RowBox[{"All", ",", 
           RowBox[{"FileNames", "[", 
            RowBox[{"\"\<Untrained U2Net\>\"", ",", 
             RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lossLayer", "@", 
       RowBox[{"NetReplacePart", "[", 
        RowBox[{"impCNN", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"NetPort", "[", "\"\<Input\>\"", "]"}], "\[Rule]", 
           RowBox[{"NetEncoder", "[", 
            RowBox[{"{", 
             RowBox[{"\"\<Image\>\"", ",", "netinputdim", ",", 
              RowBox[{"\"\<MeanImage\>\"", "->", "None"}], ",", 
              RowBox[{"\"\<VarianceImage\>\"", "->", "None"}], ",", 
              RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "}"}], 
            "]"}]}], "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771002976574435*^9, 3.771002990243063*^9}, {
   3.771004151017648*^9, 3.771004158067305*^9}, {3.7710050638579655`*^9, 
   3.7710050908674717`*^9}, {3.771078725595481*^9, 3.7710787440997515`*^9}, {
   3.771078916963237*^9, 3.77107898268756*^9}, {3.771079046100539*^9, 
   3.771079065709688*^9}, {3.771079222026287*^9, 3.771079228366332*^9}, {
   3.771079333447181*^9, 3.771079357783122*^9}, 3.771088758299014*^9, 
   3.77167719692517*^9, 3.77185297671045*^9, {3.771953474415395*^9, 
   3.771953511880062*^9}, {3.7719535572038603`*^9, 3.77195358024224*^9}, {
   3.771953626093574*^9, 3.7719536481007414`*^9}, {3.771954308339385*^9, 
   3.771954309021589*^9}, {3.7722724505415044`*^9, 3.772272584039003*^9}, {
   3.772272647167906*^9, 3.772272653131496*^9}, 3.772272959398361*^9, {
   3.772803820329001*^9, 3.772803833380645*^9}, {3.772803869315502*^9, 
   3.77280389261934*^9}, 3.772819567700001*^9, {3.772820971847187*^9, 
   3.7728209823292923`*^9}, {3.77298595439928*^9, 3.772985968974324*^9}, 
   3.773003039491411*^9, {3.773003866510935*^9, 3.773003872004843*^9}, 
   3.7730042854951205`*^9, {3.773004414232312*^9, 3.773004417997058*^9}, 
   3.773056033315851*^9, 3.773059785623024*^9, 3.773230415818958*^9, {
   3.773419417907968*^9, 3.773419427125454*^9}, 3.773506800817696*^9, {
   3.7753107684217*^9, 3.775310768478342*^9}, {3.8291528543366313`*^9, 
   3.829152870101297*^9}, {3.9678916919950695`*^9, 3.967891753554201*^9}, {
   3.96789276364069*^9, 3.9678927992969685`*^9}, 3.967893231765948*^9, {
   3.967893356406061*^9, 3.967893399570867*^9}, {3.9678935245161514`*^9, 
   3.967893538131821*^9}, 
   3.9767215727823524`*^9},ExpressionUUID->"179c10c4-8e94-483d-9e33-\
ac8e1266875d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Evaluating", " ", "this", " ", "line", " ", "begins", " ", "the", " ", 
    "Network", " ", 
    RowBox[{"training", ".", " ", "This"}], " ", "may", " ", "take", " ", 
    "from", " ", "hours", " ", "to", " ", "days", " ", "depending", " ", "on",
     " ", "the", " ", "selected", " ", "training", " ", "parameters", " ", 
    "and", " ", "computer", " ", "hardware", " ", 
    RowBox[{"specifications", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"trainednet", "=", "\[IndentingNewLine]", 
     RowBox[{"NetTrain", "[", 
      RowBox[{"networktotrain", ",", "traindatmod", ",", "All", ",", 
       RowBox[{"ValidationSet", "\[Rule]", "valdatmod"}], ",", 
       RowBox[{"LossFunction", "\[Rule]", "\"\<Losslayer\>\""}], ",", 
       RowBox[{"MaxTrainingRounds", "\[Rule]", "maxtrainingrounds"}], ",", 
       RowBox[{"TargetDevice", "\[Rule]", "\"\<GPU\>\""}], ",", 
       RowBox[{"BatchSize", "\[Rule]", "batchsize"}], ",", 
       RowBox[{"TrainingProgressReporting", "->", "report"}]}], "]"}]}], 
    ";"}], "//", "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.757770134136624*^9, 3.757770150279855*^9}, {
   3.757770222644008*^9, 3.757770225932193*^9}, {3.757770288035376*^9, 
   3.757770294675907*^9}, {3.757770340602521*^9, 3.757770340871489*^9}, {
   3.757770612970238*^9, 3.757770654828103*^9}, {3.757770832403115*^9, 
   3.757770881365863*^9}, {3.757771091909961*^9, 3.757771099810291*^9}, 
   3.757773250801607*^9, {3.758029230584422*^9, 3.75802925774976*^9}, 
   3.758899211745042*^9, {3.758901035284233*^9, 3.7589010353780413`*^9}, {
   3.758903681540614*^9, 3.7589036816655655`*^9}, {3.758903726686017*^9, 
   3.758903726842225*^9}, {3.759149898660946*^9, 3.759149899171754*^9}, {
   3.759149937616207*^9, 3.759149950636011*^9}, {3.759150015011957*^9, 
   3.759150045014487*^9}, {3.7591521472396975`*^9, 3.759152147663623*^9}, {
   3.759167331287825*^9, 3.759167331755319*^9}, {3.7592341104641066`*^9, 
   3.759234111244567*^9}, {3.759234234736974*^9, 3.759234235270313*^9}, {
   3.7592344617692304`*^9, 3.75923446229449*^9}, {3.759236315179777*^9, 
   3.759236315675916*^9}, {3.759238889181371*^9, 3.7592388897593584`*^9}, {
   3.759241435798379*^9, 3.759241437797879*^9}, {3.759258063945964*^9, 
   3.759258091732356*^9}, {3.759258189695955*^9, 3.759258190099129*^9}, {
   3.759507981885086*^9, 3.75950798221811*^9}, {3.759511119526508*^9, 
   3.759511179007452*^9}, {3.759514940389287*^9, 3.759514941466961*^9}, {
   3.7595149752051697`*^9, 3.759514975689669*^9}, {3.7597593156177673`*^9, 
   3.7597593165721135`*^9}, {3.7602014652722282`*^9, 
   3.7602014738639803`*^9}, {3.7602765372532005`*^9, 3.760276539401413*^9}, {
   3.760276682117885*^9, 3.760276682507122*^9}, {3.760276739735097*^9, 
   3.760276755267105*^9}, {3.760284137204175*^9, 3.760284154361426*^9}, {
   3.760286210892851*^9, 3.760286213532327*^9}, {3.760292947437772*^9, 
   3.760292948297164*^9}, {3.760370021179158*^9, 3.760370040768788*^9}, 
   3.7607226663437786`*^9, {3.760722782322445*^9, 3.760722803486758*^9}, {
   3.760723028519691*^9, 3.760723029911635*^9}, 3.760725220556799*^9, {
   3.760727638434887*^9, 3.760727639571723*^9}, 3.760875763675901*^9, {
   3.7608758281097984`*^9, 3.7608758282282753`*^9}, {3.760876561760158*^9, 
   3.760876561871755*^9}, 3.760877641125785*^9, {3.760893741710272*^9, 
   3.760893750157836*^9}, {3.760893819803501*^9, 3.760893819927148*^9}, {
   3.760894544540432*^9, 3.760894544664812*^9}, {3.760894738261264*^9, 
   3.760894738373502*^9}, {3.7609124249502554`*^9, 3.7609124253354497`*^9}, {
   3.760986583315429*^9, 3.760986583424998*^9}, {3.76098771962726*^9, 
   3.76098772512597*^9}, {3.761752601776323*^9, 3.761752624468379*^9}, {
   3.761752685213455*^9, 3.761752685383319*^9}, {3.7620009476336093`*^9, 
   3.762000947757109*^9}, 3.762102391984078*^9, {3.762103736101614*^9, 
   3.762103737400323*^9}, {3.762175500979955*^9, 3.762175505943455*^9}, {
   3.762184967341847*^9, 3.7621849944640865`*^9}, {3.762185215698087*^9, 
   3.762185216254558*^9}, {3.7621854199059772`*^9, 3.762185420369916*^9}, {
   3.762191366215884*^9, 3.762191366311643*^9}, {3.762191407321848*^9, 
   3.762191407440391*^9}, {3.7621914442718296`*^9, 3.762191444496518*^9}, {
   3.762537597392529*^9, 3.762537597524009*^9}, {3.762537751446614*^9, 
   3.762537767009327*^9}, {3.762538548056435*^9, 3.762538548673589*^9}, {
   3.762539178929356*^9, 3.762539179060293*^9}, {3.762607858184541*^9, 
   3.762607860296034*^9}, {3.762613452384315*^9, 3.762613452907875*^9}, {
   3.762790036745261*^9, 3.7627900438464212`*^9}, {3.76279080821059*^9, 
   3.762790825430018*^9}, 3.762795343035617*^9, 3.762795407044983*^9, {
   3.762796341241346*^9, 3.76279636150789*^9}, {3.76312088941836*^9, 
   3.76312089057751*^9}, {3.76339715451775*^9, 3.763397161359643*^9}, {
   3.763397262928272*^9, 3.763397263068899*^9}, 3.7639039935349817`*^9, {
   3.763907162097008*^9, 3.763907162682443*^9}, {3.763907295519315*^9, 
   3.7639072956808815`*^9}, 3.764093562988966*^9, {3.767366197727124*^9, 
   3.767366201600966*^9}, {3.7673662855481606`*^9, 3.767366285654905*^9}, {
   3.767366517050699*^9, 3.767366522471314*^9}, 3.767446174428832*^9, {
   3.768836830318435*^9, 3.768836830679701*^9}, {3.768836964496286*^9, 
   3.76883697016019*^9}, {3.768924063298538*^9, 3.768924063798172*^9}, {
   3.768927132644152*^9, 3.768927173661707*^9}, {3.76892723876455*^9, 
   3.768927266023775*^9}, {3.7691700662321*^9, 3.76917009144256*^9}, {
   3.7691758840731187`*^9, 3.769175886490654*^9}, {3.769179112543353*^9, 
   3.769179118238789*^9}, {3.771005132594327*^9, 3.7710051370533533`*^9}, {
   3.7710058598706307`*^9, 3.771005876885989*^9}, {3.7710804081945515`*^9, 
   3.7710804620117006`*^9}, {3.771080500669373*^9, 3.771080556911049*^9}, {
   3.771083452167115*^9, 3.771083461620843*^9}, {3.77108403476534*^9, 
   3.7710840370462465`*^9}, {3.77108636776555*^9, 3.771086368552441*^9}, {
   3.7710894522067785`*^9, 3.771089459733544*^9}, {3.771341264771335*^9, 
   3.771341264957295*^9}, {3.771953526472057*^9, 3.771953539759489*^9}, {
   3.771953657992285*^9, 3.7719536716856604`*^9}, 3.771954326696871*^9, {
   3.772819785264186*^9, 3.772819795420849*^9}, {3.772819873119878*^9, 
   3.772819915247065*^9}, 3.772819977759949*^9, 3.772820108687312*^9, 
   3.772983019798377*^9, {3.773003065719095*^9, 3.7730030722024*^9}, {
   3.773003378219087*^9, 3.7730033839065742`*^9}, {3.773003888201366*^9, 
   3.7730038900348463`*^9}, {3.787577375512843*^9, 3.78757739124612*^9}, {
   3.8895252605858345`*^9, 3.889525287754511*^9}, {3.964713924322229*^9, 
   3.964713938790615*^9}, 3.96713292808651*^9, {3.967892808716408*^9, 
   3.9678928183934402`*^9}, {3.9681569993379917`*^9, 3.968157034287716*^9}, {
   3.9767167961246815`*^9, 
   3.976716821986208*^9}},ExpressionUUID->"6038096b-0bbf-4ac7-8050-\
6c51d2e627e9"]
}, Closed]],

Cell[CellGroupData[{

Cell["extracting trained network", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771251415232394*^9, 
  3.771251434409784*^9}, {3.772885731737883*^9, 3.772885743641103*^9}, {
  3.772885956518475*^9, 3.772885956893389*^9}, {3.772886723000886*^9, 
  3.7728867230790143`*^9}},ExpressionUUID->"70d0a307-fd29-4c9c-88e6-\
722a718540b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Extracting", " ", "the", " ", "trained", " ", "network", " ", "from", " ",
     "the", " ", "training", " ", 
    RowBox[{"results", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"extractednet", "=", "\[IndentingNewLine]", 
    RowBox[{"NetReplacePart", "[", 
     RowBox[{
      RowBox[{"NetExtract", "[", 
       RowBox[{
        RowBox[{"trainednet", "[", "\"\<TrainedNet\>\"", "]"}], ",", 
        RowBox[{"{", "\"\<net\>\"", "}"}]}], "]"}], ",", 
      RowBox[{"\"\<Input\>\"", "\[Rule]", 
       RowBox[{"NetEncoder", "[", 
        RowBox[{"{", 
         RowBox[{"\"\<Image\>\"", ",", 
          RowBox[{"ImageDimensions", "[", 
           RowBox[{"First", "@", 
            RowBox[{"traindatmod", "[", "\"\<Input\>\"", "]"}]}], "]"}], ",", 
          "\"\<RGB\>\""}], "}"}], "]"}]}]}], "]"}]}], ";"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771080620890066*^9, 3.771080653606588*^9}, {
   3.771080686436831*^9, 3.771080717392095*^9}, 3.771080748528857*^9, {
   3.771086397956839*^9, 3.771086400349415*^9}, 3.771089539621487*^9, 
   3.771865429791355*^9, {3.771954105115357*^9, 3.771954155962964*^9}, 
   3.771954344776252*^9, {3.7728202736501865`*^9, 3.7728202867901144`*^9}, {
   3.7728205637382107`*^9, 3.772820589175294*^9}, {3.772820867164079*^9, 
   3.772820894385557*^9}, 3.772983038668936*^9, 3.773004202143454*^9, {
   3.77300433241172*^9, 3.773004357558107*^9}, {3.773056674821225*^9, 
   3.7730566896725235`*^9}, {3.773062067973609*^9, 3.773062068685707*^9}, 
   3.773167794332199*^9, {3.787489077109789*^9, 3.787489079287415*^9}, {
   3.787495080065448*^9, 3.787495081807843*^9}, {3.787577397839426*^9, 
   3.787577398042504*^9}, {3.829225258237595*^9, 3.829225260696374*^9}, {
   3.967893624672552*^9, 3.9678936266708603`*^9}, {3.96789377966189*^9, 
   3.967893799940583*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"cc5b2e17-071f-467b-abb8-99bdaee69571"]
}, Closed]],

Cell[CellGroupData[{

Cell["training results and metadata", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.772885869190513*^9, 3.772885894718421*^9}, {
  3.772886725094352*^9, 3.772886725203465*^9}, {3.9748160795423145`*^9, 
  3.9748160826977444`*^9}},ExpressionUUID->"e1de85eb-219e-493b-8101-\
21b4ead3aa90"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Plot", " ", "showing", " ", "training", " ", "loss", " ", 
    RowBox[{"values", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"ListLinePlot", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"trainednet", "[", "#", "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<ValidationLossList\>\"", ",", "\"\<RoundLossList\>\""}], 
       "}"}]}], "]"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<Training Round\>\"", ",", "\"\<Loss\>\""}], "}"}]}], ",", 
    RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<Validation Loss\>\"", ",", "\"\<Round Loss\>\""}], 
      "}"}]}]}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.787922371858859*^9, 3.787922419074334*^9}, {
  3.96789380742784*^9, 3.967893808890738*^9}, {3.9678938886147156`*^9, 
  3.967893938036236*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"38192e42-7d27-4de9-8f96-4e6e33b0476c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Prints", " ", "a", " ", "graphics", " ", "row", " ", "showing", " ", 
     "three", " ", 
     RowBox[{"images", ".", " ", "Starting"}], " ", "from", " ", "the", " ", 
     "left", " ", "the", " ", "first", " ", "image", " ", "is", " ", "a", " ",
      "random", " ", "input", " ", "target", " ", "image", " ", "from", " ", 
     "the", " ", "validation", " ", 
     RowBox[{"set", ".", " ", "The"}], " ", "middle", " ", "image", " ", "is",
      " ", "its", " ", "corresponding", " ", "ground", " ", "truth"}], ",", 
    " ", 
    RowBox[{
    "and", " ", "the", " ", "last", " ", "image", " ", "is", " ", "the", " ", 
     "network", " ", "segmentation", " ", "result", " ", "where", " ", "each",
      " ", "pixel", " ", "is", " ", "replaced", " ", "by", " ", "the", " ", 
     "class", " ", "index", " ", "with", " ", "the", " ", "highest", " ", 
     RowBox[{"probability", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"viewSegSample", "[", 
   RowBox[{
   "extractednet", ",", "valdatmod", ",", "\"\<GPU\>\"", ",", "colrules", ",",
     "950"}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.770134037640749*^9, 3.770134071290776*^9}, {
   3.770134944814299*^9, 3.770135012791541*^9}, {3.770141291357304*^9, 
   3.770141291451032*^9}, {3.770488781398385*^9, 3.7704887832886143`*^9}, {
   3.770508760602129*^9, 3.7705087857856817`*^9}, {3.770544761410831*^9, 
   3.770544769531188*^9}, {3.77054491588323*^9, 3.7705449169636097`*^9}, {
   3.771008097027053*^9, 3.7710081699062147`*^9}, {3.771008201530487*^9, 
   3.771008203856245*^9}, {3.771008449580002*^9, 3.771008488338363*^9}, {
   3.771080774252108*^9, 3.771080795625003*^9}, {3.771084081742804*^9, 
   3.7710840818275456`*^9}, {3.771086418622574*^9, 3.771086419585*^9}, 
   3.7728206090648127`*^9, {3.772821666005787*^9, 3.772821668938261*^9}, {
   3.772821759350526*^9, 3.772821762463718*^9}, {3.773000221685519*^9, 
   3.7730002231586647`*^9}, {3.773001379519029*^9, 3.7730013863586025`*^9}, {
   3.773168091136011*^9, 3.7731681015649786`*^9}, {3.77317742631408*^9, 
   3.773177436409307*^9}, {3.77419959061408*^9, 3.774199649221536*^9}, 
   3.787489134374786*^9, {3.787577403510909*^9, 3.787577403713981*^9}, {
   3.828725074477878*^9, 3.828725075118353*^9}, {3.9331539866202393`*^9, 
   3.933154039087005*^9}, {3.933154080988676*^9, 3.933154239519396*^9}, {
   3.967893821007279*^9, 3.967893853782818*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"076cb38a-ec09-4ab3-8121-de9ceb897ac5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Training", " ", "metadata", " ", "for", " ", 
    RowBox[{"export", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"metadata", "=", 
   RowBox[{"networkSummary", "[", 
    RowBox[{"trainednet", ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<ValidationLossList\>\"", ",", "\"\<RoundLossList\>\"", ",", 
       "\"\<BatchSize\>\"", ",", "\"\<BestValidationRound\>\"", ",", 
       "\"\<TotalRounds\>\"", ",", "\"\<TotalTrainingTime\>\"", ",", 
       "\"\<InitialLearningRate\>\"", ",", "\"\<FinalLearningRate\>\""}], 
      "}"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.766513736472782*^9, 3.766513770733871*^9}, {
   3.766513844196409*^9, 3.766513844474448*^9}, {3.76651393296982*^9, 
   3.766513943168858*^9}, {3.766514232726674*^9, 3.766514245395881*^9}, {
   3.766526147920394*^9, 3.766526154623576*^9}, 3.766833451654286*^9, {
   3.769176487356197*^9, 3.769176496942565*^9}, {3.771007505333889*^9, 
   3.771007563202214*^9}, {3.96789394455682*^9, 3.967893965844691*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"9f4e1f2a-19dc-4f34-b1cd-1be7ac3a9c49"]
}, Closed]],

Cell[CellGroupData[{

Cell["exporting trained network and metadata", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.7710025215091534`*^9, 3.771002530173191*^9}, {
  3.771002586791958*^9, 3.771002634491653*^9}, {3.771007313768434*^9, 
  3.771007321110459*^9}, {3.771251443720127*^9, 3.7712514599506865`*^9}, {
  3.772885978435163*^9, 3.772885978778847*^9}, {3.7728867274531827`*^9, 
  3.7728867275469*^9}},ExpressionUUID->"491586d0-cf64-4c24-8153-4f44f98baf94"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Exporting", " ", "trained", " ", 
    RowBox[{"network", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"dataExpMod", "[", 
   RowBox[{"extractednet", ",", 
    RowBox[{"StringJoin", "[", 
     RowBox[{"exportfilename", ",", "\"\<.wmlf\>\""}], "]"}], ",", 
    "netexportpath"}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771007339566331*^9, 3.771007438326169*^9}, {
   3.77100925472924*^9, 3.771009255464647*^9}, {3.771080805781854*^9, 
   3.771080808013885*^9}, 3.8637919390663285`*^9, {3.967893969269544*^9, 
   3.967893978935093*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"c5e48330-157d-4082-86cb-09da50fc117c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Exporting", " ", "training", " ", 
    RowBox[{"metadata", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"dataExpMod", "[", 
   RowBox[{
    RowBox[{"Normal", "@", "metadata"}], ",", 
    RowBox[{"StringJoin", "[", 
     RowBox[{"exportfilename", ",", "\"\<.mx\>\""}], "]"}], ",", 
    "metadataexportpath"}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771007578277067*^9, 3.771007648220521*^9}, {
  3.7710076830114756`*^9, 3.771007685089116*^9}, {3.967893982110668*^9, 
  3.9678939913318005`*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"e40c1470-09d7-4c5a-b216-764457a2acb4"]
}, Closed]],

Cell[CellGroupData[{

Cell["exporting  test data for IoU", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.7710025215091534`*^9, 3.771002530173191*^9}, {
   3.771002586791958*^9, 3.771002634491653*^9}, {3.771007313768434*^9, 
   3.771007321110459*^9}, {3.771251443720127*^9, 3.7712514599506865`*^9}, {
   3.772885978435163*^9, 3.772885978778847*^9}, {3.7728867274531827`*^9, 
   3.7728867275469*^9}, {3.787580586709556*^9, 3.787580596802614*^9}, 
   3.787580631706438*^9, 3.967894018321707*^9, {3.974816099693796*^9, 
   3.974816101552511*^9}},ExpressionUUID->"fa28effe-9d00-45e0-b785-\
5d2de8ea9ce0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Exporting", " ", "test", " ", "data", " ", "for", " ", "IoU", " ", 
    RowBox[{"calculation", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"exportData", "[", 
     RowBox[{
     "testdata", ",", "testdataexporttarget", ",", "testdataexportgt", ",", 
      "testdataexportmulticlass", ",", "numofclasses", ",", 
      "classindexchange", ",", "newclassindex"}], "]"}], ";"}], "//", 
   "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.828722880385225*^9, 3.828722897655227*^9}, {
   3.863787501294616*^9, 3.863787505860619*^9}, {3.863787572166257*^9, 
   3.863787583950167*^9}, 3.964798125533708*^9, 3.964798366911341*^9, {
   3.9678939945261784`*^9, 3.967894030384938*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"4b2a4fdf-4afb-4db3-a52d-c1d45cdb8482"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Segmenting images using trained CNN", "Section",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771091367329028*^9, 3.771091376051399*^9}, {
   3.771091414565285*^9, 3.771091444641539*^9}, {3.771260575359153*^9, 
   3.771260576086752*^9}, {3.771340062622161*^9, 3.771340062909441*^9}, 
   3.771341269236918*^9, {3.772886950496659*^9, 3.772886960962979*^9}, {
   3.974813187322204*^9, 
   3.974813216418123*^9}},ExpressionUUID->"22a2149f-8659-48d1-893e-\
b6857c94950c"],

Cell[CellGroupData[{

Cell["loading previously trained network", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.7729826601176715`*^9, 
  3.772982668097346*^9}},ExpressionUUID->"6a0f6666-1697-4977-afc0-\
3b0275494c45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"importing", " ", "previously", " ", "trained", " ", "network"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"prevtrained", "=", 
     RowBox[{"Import", "[", "trainednetpath", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"netdiminput", "=", 
    RowBox[{"NetExtract", "[", 
     RowBox[{"prevtrained", ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Input\>\"", ",", "\"\<ImageSize\>\""}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771092710182492*^9, 3.771092712825446*^9}, {
   3.771093344576795*^9, 3.7710933510245814`*^9}, {3.771160336459303*^9, 
   3.771160348990243*^9}, 3.771599921255824*^9, 3.771607374925603*^9, 
   3.771876627015978*^9, {3.7718767308436265`*^9, 3.771876731197084*^9}, 
   3.7722955016919746`*^9, {3.9678987319785366`*^9, 3.967898745723627*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"2978ff21-156b-4ac7-8b7a-e5df72fcc212"]
}, Closed]],

Cell[CellGroupData[{

Cell["importing image files", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.771252157568183*^9}, {3.7712522092444525`*^9, 3.7712522094477777`*^9}, {
  3.7729826039797*^9, 3.772982604292891*^9}, {3.895071771506351*^9, 
  3.895071776279414*^9}, {3.9678994079037037`*^9, 
  3.9678994083762665`*^9}},ExpressionUUID->"7b39a684-06d0-4629-9cc0-\
675ae841fa4f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"viewing", " ", "import", " ", "file", " ", "paths"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"activeimgdirectory", "=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Catch", "[", 
        RowBox[{"viewFiles", "[", 
         RowBox[{"#", ",", "20"}], "]"}], "]"}], "&"}], ",", "imagepaths"}], 
     "]"}]}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771093443766674*^9, 3.7710934490784593`*^9}, 
   3.771093551444873*^9, {3.7710946207965684`*^9, 3.77109468180864*^9}, {
   3.7710963763134193`*^9, 3.771096392731453*^9}, {3.771160354027013*^9, 
   3.771160379374975*^9}, {3.771160488964208*^9, 3.7711604967955637`*^9}, {
   3.771164065401751*^9, 3.771164067241231*^9}, {3.771599447871191*^9, 
   3.771599466218281*^9}, {3.7715997733445616`*^9, 3.771599775861826*^9}, {
   3.771599826812508*^9, 3.771599828468082*^9}, {3.771599916346958*^9, 
   3.771599942198711*^9}, {3.771600881272149*^9, 3.771600881753839*^9}, {
   3.771806713644266*^9, 3.7718067184872885`*^9}, {3.771806772968249*^9, 
   3.7718067969804235`*^9}, 3.77180751022939*^9},
 CellLabel->"In[36]:=",ExpressionUUID->"c18b66ac-cdc7-45f6-a8c1-180ba5ad1b65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "number", " ", "of", " ", "files", " ", "contained", " ", "within", " ", 
    "the", " ", "active", " ", "image", " ", 
    RowBox[{"directories", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"countF", "[", "activeimgdirectory", "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771160279473393*^9, 3.771160283994813*^9}, {
   3.771160528542454*^9, 3.771160577342686*^9}, {3.771160662724887*^9, 
   3.7711608143982477`*^9}, {3.7711639913783875`*^9, 3.771164028068818*^9}, {
   3.77116407849543*^9, 3.77116409424787*^9}, 3.77159993953841*^9, {
   3.773398704118726*^9, 3.773398827989909*^9}, {3.9678976818132706`*^9, 
   3.967897682220049*^9}, {3.9678977445652046`*^9, 3.967897776074353*^9}, {
   3.967897888743601*^9, 3.967897894796821*^9}, 3.967901784964691*^9},
 CellLabel->"In[37]:=",ExpressionUUID->"68450152-286d-40bf-8628-df197ef53631"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"importing", " ", "images"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imgs", ",", "imgfilenames"}], "}"}], "=", 
     RowBox[{
      RowBox[{"MapAt", "[", 
       RowBox[{"Flatten", ",", 
        RowBox[{"Transpose", "@", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"imgImportFunc", "[", 
             RowBox[{
             "#", ",", "mode", ",", "numrandom", ",", "listofpositions"}], 
             "]"}], "&"}], ",", "activeimgdirectory"}], "]"}]}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{"Null", "\[Rule]", "Nothing"}], "}"}]}]}], ";"}], "//", 
   "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771163092587834*^9, 3.771163136956017*^9}, {
   3.7711633043017874`*^9, 3.771163305375551*^9}, {3.7711634526691837`*^9, 
   3.771163467986311*^9}, {3.771163512354842*^9, 3.771163524258022*^9}, {
   3.771164104427052*^9, 3.7711641061460714`*^9}, 3.829741035165825*^9},
 CellLabel->"In[38]:=",ExpressionUUID->"128f6653-9abb-45ff-bb29-919730b8b2c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "function", " ", "selects", " ", "the", " ", "image", " ", 
     "data", " ", "when", " ", "importing", " ", "data", " ", "in", " ", 
     "the", " ", "form", " ", 
     RowBox[{"ImageData", "[", "image", "]"}]}], "\[Rule]", "gtarray"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"imgsmod", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "===", "Rule"}], ",", 
         RowBox[{"ColorConvert", "[", 
          RowBox[{
           RowBox[{"Image", "@", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", "imagetype1"}], "]"}], 
         ",", "#"}], "]"}], "&"}], ",", "imgs"}], "]"}]}], ";"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.829741087024308*^9, 3.829741111132801*^9}, {
  3.829741141228785*^9, 3.829741200589313*^9}, {3.829741237789844*^9, 
  3.829741240812847*^9}, {3.82974127588588*^9, 3.8297412865729055`*^9}, {
  3.829741386940298*^9, 3.829741422797045*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"576b8f66-0e5c-4343-93d7-e751903e5c90"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "dimensions", " ", "and", " ", "total", " ", "number", " ", "of", " ", 
    "imported", " ", "images", " ", "for", " ", "testing"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"imgdims", "=", 
    RowBox[{"Tally", "[", 
     RowBox[{"ImageDimensions", "/@", "imgsmod"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"Length", "@", "imgsmod"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771163353001513*^9, 3.7711633564618645`*^9}, {
   3.771163941473611*^9, 3.771163973569495*^9}, {3.771177625268775*^9, 
   3.7711776267267857`*^9}, {3.772983168979622*^9, 3.7729831741827173`*^9}, 
   3.828816557410578*^9, {3.829741040877485*^9, 3.829741043356948*^9}, {
   3.829741491085291*^9, 3.8297415103652945`*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"c7660823-4253-4f5f-9f63-696f7193d586"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"printing", " ", "file", " ", "names", " ", "imported"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"filenamelist", "=", 
     RowBox[{"TakeList", "[", 
      RowBox[{
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"First", "@", "#2"}], "\[Rule]", "#1"}], "&"}], ",", 
         RowBox[{"Flatten", "@", "imgfilenames"}]}], "]"}], ",", 
       RowBox[{"Length", "/@", "imgfilenames"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dataset", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"TableForm", "[", 
        RowBox[{
         RowBox[{"List", "/@", 
          RowBox[{"Normal", "[", 
           RowBox[{"Map", "[", 
            RowBox[{"FileBaseName", ",", 
             RowBox[{"Association", "[", 
              RowBox[{"filenamelist", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], ",", 
         RowBox[{"TableHeadings", "->", 
          RowBox[{"{", 
           RowBox[{"None", ",", 
            RowBox[{"{", 
             RowBox[{"ToString", "[", 
              RowBox[{"FileNameTake", "[", 
               RowBox[{
                RowBox[{"activeimgdirectory", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"-", "5"}]}], "]"}], "]"}], "}"}]}], "}"}]}]}], "]"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "activeimgdirectory", "]"}]}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Manipulate", "[", 
    RowBox[{
     RowBox[{"dataset", "[", 
      RowBox[{"[", "i", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "dataset", "]"}], ",", "1"}], "}"}], ",", 
     RowBox[{"ControlPlacement", "->", "Top"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7711636695277295`*^9, 3.771163670903144*^9}, {
   3.771163722942408*^9, 3.771163746992789*^9}, {3.7712472024880185`*^9, 
   3.771247239088815*^9}, {3.771601430127118*^9, 3.7716014419155455`*^9}, 
   3.7716014750014677`*^9, {3.785673118275009*^9, 3.7856731479178*^9}, 
   3.785673429253373*^9, {3.9331560217181377`*^9, 3.933156109657591*^9}, {
   3.965304534585478*^9, 3.965304762346287*^9}, 3.965304848405298*^9, {
   3.965306627345442*^9, 3.965306679665676*^9}, {3.965306722416579*^9, 
   3.9653067248342457`*^9}, {3.974816783654365*^9, 3.9748167881218033`*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"5cc55931-374b-402a-84ed-5d1e8bd1bda8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Display", " ", "of", " ", "imported", " ", 
    RowBox[{"images", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Manipulate", "[", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"imgsmod", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"ImageSize", "->", "displaysize"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "imgsmod", "]"}], ",", "1"}], "}"}], ",", 
    RowBox[{"ControlPlacement", "->", "Top"}]}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.967646672338272*^9, 3.9676467851443825`*^9}, 
   3.9748167952049294`*^9},
 CellLabel->"In[45]:=",ExpressionUUID->"a994b4d4-1bd1-c044-8b0b-f2f50233cc7a"]
}, Closed]],

Cell[CellGroupData[{

Cell["segmenting one test image", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.77125225771771*^9}, {3.772982607787551*^9, 3.772982607872322*^9}, {
  3.974813058243311*^9, 
  3.974813059000954*^9}},ExpressionUUID->"127decb5-2322-4519-bd07-\
a0db9f6ecd21"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "view", " ", "a", " ", "segmentation", " ", "preview", " ", "for", " ", 
    "one", " ", "of", " ", "the", " ", "loaded", " ", "images"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"segres", "=", 
      RowBox[{"segEvaFunc", "[", 
       RowBox[{
        RowBox[{"imgsmod", "[", 
         RowBox[{"[", "pos", "]"}], "]"}], ",", "prevtrained", ",", 
        "netdiminput", ",", "partitionoverlap", ",", "targetdevice", ",", 
        "pixelpredict"}], "]"}]}], ";"}], "//", "AbsoluteTiming"}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "segres", "]"}], "===", "String"}], ",", 
     "segres"}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771168087590411*^9, 3.771168201747623*^9}, {
   3.771177323701378*^9, 3.771177344701765*^9}, {3.771177772307594*^9, 
   3.771177786717156*^9}, {3.7712474266923466`*^9, 3.7712474285041733`*^9}, {
   3.771247852776379*^9, 3.771247882940772*^9}, {3.771248905422618*^9, 
   3.771248920825083*^9}, {3.771248969251155*^9, 3.7712489717974625`*^9}, {
   3.771605277973769*^9, 3.771605291303527*^9}, 3.771605566192647*^9, 
   3.771606709951685*^9, 3.772897388074023*^9, {3.772898248843873*^9, 
   3.772898251248126*^9}, {3.7729737563373*^9, 3.7729737852542744`*^9}, 
   3.829741530368255*^9, 3.967900849872307*^9, {3.967900932309326*^9, 
   3.967900974870959*^9}, {3.9748168640365467`*^9, 3.9748168672077065`*^9}, {
   3.974817178835729*^9, 3.974817182100582*^9}, {3.9748185939346232`*^9, 
   3.9748185960748587`*^9}, 
   3.974818638561706*^9},ExpressionUUID->"cd005c2e-f7d0-45b7-906d-\
0d3c4a94931e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "function", " ", "will", " ", "display", " ", "the", " ", 
    "resulting", " ", "image", " ", "where", " ", "each", " ", "pixel", " ", 
    "represents", " ", "the", " ", "class", " ", "with", " ", "the", " ", 
    "greatest", " ", 
    RowBox[{"probability", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"view", "=", 
   RowBox[{"arrayToRGBimg", "[", 
    RowBox[{"segres", ",", "colrules"}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.774201216288579*^9, 3.774201221563315*^9}, 
   3.774201256146961*^9, {3.774201291394604*^9, 3.774201348519437*^9}, {
   3.7753160533890204`*^9, 3.7753160820551414`*^9}, {3.779191839965502*^9, 
   3.779191840177038*^9}, {3.829056847423031*^9, 3.82905685515914*^9}, {
   3.829056943806449*^9, 3.829056998163756*^9}, {3.829834638246515*^9, 
   3.8298346443091493`*^9}, {3.830363819867845*^9, 3.830363862893314*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"810ccdf7-9aec-4954-9059-f60fc78f663f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Pan", " ", "and", " ", "zoom", " ", "in", " ", "on", " ", "the", " ", 
    "segres", " ", 
    RowBox[{"result", ".", " ", "This"}], " ", "function", " ", "displays", 
    " ", "the", " ", "probability", " ", "map", " ", "of", " ", "the", " ", 
    "selected", " ", 
    RowBox[{"class", ".", " ", "This"}], " ", "function", " ", "only", " ", 
    "works", " ", "if", " ", "segres", " ", "was", " ", "evaluated", " ", 
    "with", " ", "pixel", " ", "predict", " ", "set", " ", "to", " ", 
    RowBox[{"\"\<no\>\"", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"pixelpredict", "\[Equal]", "\"\<no\>\""}], ",", 
    RowBox[{"DynamicImage", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ColorSeparate", "[", "segres", "]"}], "[", 
       RowBox[{"[", "classposition", "]"}], "]"}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}]}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7711776979816*^9, 3.771177709331709*^9}, {
   3.77124792033828*^9, 3.771247945894747*^9}, {3.771249034615094*^9, 
   3.77124904850244*^9}, {3.7729032981294475`*^9, 3.7729033113102183`*^9}, {
   3.77290346942217*^9, 3.772903579962329*^9}, {3.7729039643814864`*^9, 
   3.772903969677322*^9}, {3.7729040047822013`*^9, 3.772904013388645*^9}, {
   3.772904170713837*^9, 3.772904172229189*^9}, 3.772904226373805*^9, {
   3.772904294061022*^9, 3.7729042959983053`*^9}, {3.772904333870922*^9, 
   3.772904347180308*^9}, {3.7729043774386225`*^9, 3.7729044257434373`*^9}, {
   3.7729044927902193`*^9, 3.772904497820267*^9}, {3.772904639168336*^9, 
   3.772904656726926*^9}, 3.772904831047393*^9, {3.77296753668983*^9, 
   3.772967537467406*^9}, {3.772968014944394*^9, 3.772968057672594*^9}, 
   3.772968117110925*^9, 3.7729736527635555`*^9, {3.7742012269912715`*^9, 
   3.774201236865526*^9}, 3.774201284905591*^9, {3.775918581526775*^9, 
   3.7759185999000273`*^9}, {3.829053439651067*^9, 3.829053484383527*^9}, {
   3.829055991656474*^9, 3.82905599432354*^9}, {3.829056024359065*^9, 
   3.8290560699206233`*^9}, {3.82905667811722*^9, 3.8290567091099668`*^9}, {
   3.829057073783492*^9, 3.8290570924480743`*^9}, {3.829057312053724*^9, 
   3.8290573204171247`*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"baa51930-bf62-4cd7-8b06-71b160424ed7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "function", " ", "diplays", " ", "the", " ", "target", " ", 
    "image", " ", "in", " ", "the", " ", "top", " ", 
    RowBox[{"column", ".", " ", "The"}], " ", "bottom", " ", "column", " ", 
    "is", " ", "an", " ", "image", " ", "highlight", " ", "composition", " ", 
    "of", " ", "the", " ", "target", " ", "image", " ", "with", " ", "a", " ",
     "threshold", " ", "of", " ", "the", " ", "selected", " ", 
    RowBox[{"class", ".", " ", "This"}], " ", "function", " ", "only", " ", 
    "works", " ", "if", " ", "segres", " ", "was", " ", "evaluated", " ", 
    "with", " ", "pixel", " ", "predict", " ", "set", " ", "to", " ", 
    RowBox[{"\"\<no\>\"", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"pixelpredict", "\[Equal]", "\"\<no\>\""}], ",", 
    RowBox[{"imgHighlight", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"imgsmod", "[", 
        RowBox[{"[", "pos", "]"}], "]"}], "}"}], ",", "segres", ",", 
      "classposition", ",", "threshold", ",", "displaysize", ",", "False"}], 
     "]"}]}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.779194177453723*^9, 3.779194238495894*^9}, {
   3.8290535399706564`*^9, 3.829053541867789*^9}, {3.829053621325635*^9, 
   3.829053643433006*^9}, {3.829054205307581*^9, 3.8290542139954853`*^9}, {
   3.82905609243385*^9, 3.829056121265222*^9}, {3.82905616042026*^9, 
   3.82905618641285*^9}, {3.829056226512706*^9, 3.829056248642918*^9}, {
   3.829056282648527*^9, 3.8290563203345327`*^9}, {3.829057190713628*^9, 
   3.829057191972399*^9}, {3.829057241242494*^9, 3.829057255862049*^9}, 
   3.829057332775125*^9, 3.829741547493306*^9, 3.829741797534949*^9, {
   3.829741837837808*^9, 3.8297418380289593`*^9}, {3.829741945550432*^9, 
   3.8297419469468603`*^9}, {3.871121111267628*^9, 3.871121136007223*^9}, {
   3.871121216355811*^9, 3.87112123108354*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"36d05ad3-37b3-4d82-8e5b-76b27cb65f73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Highlighting", " ", "gray", " ", "image", " ", "with", " ", "a", " ", 
    "mask", " ", "of", " ", "the", " ", "segmentation", " ", "result", " ", 
    "thresholded", " ", "at", " ", "a", " ", "probability", " ", "of", " ", 
    "50", 
    RowBox[{"%", ".", " ", "This"}], " ", "function", " ", "only", " ", 
    "works", " ", "if", " ", "segres", " ", "was", " ", "evaluated", " ", 
    "with", " ", "pixel", " ", "predict", " ", "set", " ", "to", " ", 
    RowBox[{"\"\<no\>\"", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"dragZoomShow", "@", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"pixelpredict", "\[Equal]", "\"\<no\>\""}], ",", 
     RowBox[{"HighlightImage", "[", 
      RowBox[{
       RowBox[{"ImageAdjust", "[", 
        RowBox[{
         RowBox[{"imgsmod", "[", 
          RowBox[{"[", "pos", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"contrast", ",", "brightness", ",", "gamma"}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"Flatten", "@", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"classcolor", ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"EdgeForm", "[", "]"}], ",", 
                RowBox[{"Opacity", "[", "opacity", "]"}]}], "}"}], ",", 
              RowBox[{"{", "numberofclasses", "}"}]}], "]"}], ",", 
            RowBox[{"ColorSeparate", "@", "segres"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.77124881185881*^9, 3.77124882960468*^9}, {
   3.7712491114963837`*^9, 3.771249114573787*^9}, {3.7712495573839912`*^9, 
   3.7712495767856884`*^9}, {3.771608410747252*^9, 3.771608428375611*^9}, {
   3.771762662534081*^9, 3.7717626859559116`*^9}, 3.772904852698334*^9, {
   3.775918480620571*^9, 3.77591852328281*^9}, {3.7759186365655584`*^9, 
   3.775918673839925*^9}, {3.775919115589148*^9, 3.775919193019755*^9}, {
   3.775919263187401*^9, 3.775919265699363*^9}, {3.775919431374078*^9, 
   3.775919476676379*^9}, {3.776085867150238*^9, 3.7760859143565593`*^9}, {
   3.776086552016635*^9, 3.7760865536447687`*^9}, {3.776087537800771*^9, 
   3.776087541828235*^9}, 3.779191960964995*^9, 3.779192658817183*^9, {
   3.779193153203911*^9, 3.779193156675811*^9}, {3.7791931875344276`*^9, 
   3.779193218126393*^9}, {3.7791934800390854`*^9, 3.779193546951475*^9}, 
   3.779193648033572*^9, {3.779193921653312*^9, 3.779193933623115*^9}, {
   3.78560372089593*^9, 3.7856037211771*^9}, {3.785609689341051*^9, 
   3.785609724945904*^9}, {3.787923699398951*^9, 3.787923742536572*^9}, 
   3.7900843393910675`*^9, 3.8287243882895956`*^9, 3.828724428960921*^9, {
   3.829053545031057*^9, 3.8290535868566785`*^9}, {3.829056345141114*^9, 
   3.829056346610084*^9}, {3.8290567879276156`*^9, 3.829056788568306*^9}, {
   3.8290572128765*^9, 3.8290572259440165`*^9}, 3.829057338003787*^9, 
   3.8297415742219906`*^9, {3.896974196006147*^9, 3.8969742045652122`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"ca009f7f-3b54-4b32-82c4-de99678303f8"]
}, Closed]],

Cell[CellGroupData[{

Cell["segmenting all imported images", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.7712522708240223`*^9}, {3.772982609637575*^9, 3.772982609733349*^9}, {
  3.974813033871046*^9, 
  3.974813062640513*^9}},ExpressionUUID->"4191e48c-32f2-4119-83f6-\
6e63b1839932"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Applies", " ", "CNN", " ", "segmentation", " ", "to", " ", "all", " ", 
    "imported", " ", 
    RowBox[{"images", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"segresmult", "=", 
     RowBox[{"mapMonitor", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"segEvaFunc", "[", 
         RowBox[{
         "#", ",", "prevtrained", ",", "netdiminput", ",", "partitionoverlap",
           ",", "targetdevice", ",", "pixelpredict"}], "]"}], "&"}], ",", 
       "imgsmod"}], "]"}]}], ";"}], "//", "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771249697605607*^9, 3.7712497286352243`*^9}, {
   3.7713429696770124`*^9, 3.7713429698124247`*^9}, {3.771605434560639*^9, 
   3.7716054549682*^9}, 3.771605603188517*^9, {3.7729048653518195`*^9, 
   3.7729048673357286`*^9}, 3.829741602461975*^9, {3.829834889354251*^9, 
   3.829834890796376*^9}, 3.967901044397043*^9, {3.968156448001871*^9, 
   3.9681564804837933`*^9}, 
   3.974818614335964*^9},ExpressionUUID->"4f32df0e-6fdb-4d59-93bf-\
23aa35691b82"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Converts", " ", "resulting", " ", "probability", " ", "maps", " ", "to", 
    " ", "RGB", " ", "images", " ", "where", " ", "each", " ", "pixel", " ", 
    "is", " ", "assigned", " ", "a", " ", "color", " ", "corresponding", " ", 
    "to", " ", "its", " ", "maximum", " ", "probability", " ", 
    RowBox[{"class", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"maxprobpixels", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"arrayToRGBimg", "[", 
         RowBox[{"#", ",", "colrules"}], "]"}], "&"}], ",", "segresmult"}], 
      "]"}]}], ";"}], "//", "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.773163380754413*^9, 3.773163501245502*^9}, {
   3.773163569414558*^9, 3.773163589901817*^9}, 3.775920431251591*^9, 
   3.8298344648850965`*^9, {3.82983452507117*^9, 3.82983459382152*^9}, {
   3.9681564881932926`*^9, 3.9681564899610634`*^9}, {3.968156611071186*^9, 
   3.96815666169195*^9}, {3.9681571709634285`*^9, 3.96815718434408*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"6fc9b9d7-e5e7-4e7c-a9d9-bdc0170e605a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Displays", " ", "results", " ", "from", " ", 
    RowBox[{"maxprobpixels", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Manipulate", "[", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"maxprobpixels", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "displaysize"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "@", "maxprobpixels"}], ",", "1"}], "}"}], ",", 
    RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7731635934148355`*^9, 3.773163609708518*^9}, {
  3.773163687410098*^9, 3.773163688983186*^9}, {3.7794608969865837`*^9, 
  3.7794609429238267`*^9}, {3.8287248679385495`*^9, 3.828724878802992*^9}, {
  3.828725921353907*^9, 3.828725930398634*^9}, {3.8298344950475388`*^9, 
  3.829834496991*^9}, {3.829834602457001*^9, 3.82983461132114*^9}, {
  3.968157070079609*^9, 3.968157077280323*^9}, {3.968157200202587*^9, 
  3.968157207197809*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"e9ab29b0-81d5-48a9-b2ec-dabe0bf74c8c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Displays", " ", "side", " ", "by", " ", "side", " ", "comparision", " ", 
    "of", " ", "target", " ", "image", " ", "with", " ", "a", " ", 
    "thresholded", " ", "CNN", " ", "result", " ", "of", " ", "a", " ", 
    "selected", " ", 
    RowBox[{"class", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"pixelpredict", "\[Equal]", "\"\<no\>\""}], ",", 
    RowBox[{"Manipulate", "[", 
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"imgHighlight", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"imgsmod", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
          RowBox[{"segresmult", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", "classposition", ",", 
          "threshold", ",", "displaysize", ",", "orient"}], "]"}], ",", 
        RowBox[{"ImageSize", "->", "displaysize"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "@", "segresmult"}], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"orient", ",", 
        RowBox[{"{", 
         RowBox[{"True", ",", "False"}], "}"}]}], "}"}], ",", 
      RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.776086325631453*^9, 3.776086425645823*^9}, {
   3.7760868001371036`*^9, 3.776086802751666*^9}, {3.776098633869568*^9, 
   3.776098633963323*^9}, 3.779192857581196*^9, {3.7791943103335013`*^9, 
   3.779194310986798*^9}, 3.8098849018589582`*^9, 3.809953233903965*^9, {
   3.82905376477067*^9, 3.829053792534648*^9}, {3.829054797101223*^9, 
   3.829054821601656*^9}, {3.829054977783411*^9, 3.829054983462579*^9}, {
   3.829057493936696*^9, 3.829057503460198*^9}, 3.829741651374214*^9, {
   3.82974357870376*^9, 3.829743580180872*^9}, {3.829835068089331*^9, 
   3.829835089022106*^9}, {3.8643798523836746`*^9, 3.864379852824208*^9}, {
   3.8711208589834056`*^9, 3.871120897726773*^9}, {3.8711216918423615`*^9, 
   3.8711217045838084`*^9}, {3.968157320116959*^9, 3.9681573251785526`*^9}, {
   3.968157415307593*^9, 
   3.968157470336609*^9}},ExpressionUUID->"58c43e1d-5ac1-4e8d-bc7c-\
7863634c7346"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Overlay", " ", "of", " ", "the", " ", "target", " ", "image", " ", "with",
     " ", "the", " ", "resulting", " ", "max", " ", "probability", " ", 
    "class", " ", "for", " ", "each", " ", 
    RowBox[{"pixel", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"pixelpredict", "\[Equal]", "\"\<no\>\""}], ",", 
    RowBox[{"Manipulate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"dragZoomShow", "@", 
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", 
           RowBox[{"ImageSize", "\[Rule]", "displaysize"}]}], "]"}]}], "&"}], 
       "@", 
       RowBox[{"HighlightImage", "[", 
        RowBox[{
         RowBox[{"ImageAdjust", "[", 
          RowBox[{
           RowBox[{"imgsmod", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"contrast", ",", "brightness", ",", "gamma"}], "}"}]}], 
          "]"}], ",", 
         RowBox[{"Flatten", "@", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"classcolor", ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"EdgeForm", "[", "]"}], ",", 
                  RowBox[{"Opacity", "[", "opacity", "]"}]}], "}"}], ",", 
                RowBox[{"{", "numberofclasses", "}"}]}], "]"}], ",", 
              RowBox[{"ColorSeparate", "@", 
               RowBox[{"segresmult", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}]}]}], 
        "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "@", "segresmult"}], ",", "1"}], "}"}], ",", 
      RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.775920964247017*^9, 3.775920988884697*^9}, {
   3.775921067897157*^9, 3.775921078345959*^9}, {3.7759211240821843`*^9, 
   3.7759211244005756`*^9}, 3.779192778607718*^9, {3.779193315292955*^9, 
   3.779193319801474*^9}, 3.779193351846628*^9, {3.77919339026258*^9, 
   3.7791933940306635`*^9}, {3.7791934349550905`*^9, 3.779193436835972*^9}, {
   3.779193682255362*^9, 3.779193720271466*^9}, {3.779193910466089*^9, 
   3.779193911055732*^9}, {3.779193944666526*^9, 3.7791939448164806`*^9}, {
   3.809884857373459*^9, 3.809884862016908*^9}, 3.809953206882304*^9, {
   3.82905370071291*^9, 3.8290537016817617`*^9}, {3.829056355894812*^9, 
   3.829056378078306*^9}, {3.829057450358528*^9, 3.829057469063029*^9}, 
   3.829741644721198*^9, {3.829743655073385*^9, 3.8297436562768593`*^9}, {
   3.896974930320199*^9, 3.8969749511428747`*^9}, {3.897034705633386*^9, 
   3.897034707005991*^9}, {3.96530371227756*^9, 3.965303713204758*^9}, {
   3.9653037530491104`*^9, 3.965303834870085*^9}, {3.968157475254257*^9, 
   3.968157526605543*^9}},ExpressionUUID->"109adba5-345d-4bf6-9614-\
fa527749fbd1"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "exporting  ",
 StyleBox["segresmult",
  IgnoreSpellCheck->True]
}], "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.7712522708240223`*^9}, {3.772982609637575*^9, 3.772982609733349*^9}, {
  3.7856105009416*^9, 
  3.785610512756326*^9}},ExpressionUUID->"3e521865-925f-47ea-871a-\
1c64e3ea3ebd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Imported", " ", "images", " ", "file", " ", 
    RowBox[{"names", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"filename1", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"FileNameTake", "[", 
       RowBox[{"#1", ",", 
        RowBox[{"-", "1"}]}], "]"}], "&"}], ",", 
     RowBox[{"Flatten", "@", "imgfilenames"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.785613883191118*^9, 3.7856140917456656`*^9}, {
   3.8290584412654934`*^9, 3.829058442714227*^9}, {3.829058486003753*^9, 
   3.829058496301928*^9}, 3.829227172281483*^9, {3.968156949510933*^9, 
   3.9681569614751453`*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"00f6ed7a-44eb-4e14-864f-da3a080d0839"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Export", " ", "segmentation", " ", 
    RowBox[{"results", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"segExport", "[", 
       RowBox[{
       "#1", ",", "#2", ",", "outputdirectory", ",", "fileextension"}], "]"}],
       "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"segresmult", ",", "filename1"}], "}"}]}], "]"}], 
   ";"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.785611744324411*^9, 3.785611786664528*^9}, {
   3.785612723777927*^9, 3.785612732912164*^9}, {3.785613258724653*^9, 
   3.785613304356082*^9}, {3.785613544350518*^9, 3.785613545615844*^9}, 
   3.7856137249741206`*^9, {3.785613786196417*^9, 3.7856138160806403`*^9}, {
   3.785614098433109*^9, 3.7856140994328785`*^9}, 3.829227246871235*^9, 
   3.83043236627004*^9, {3.830432448757448*^9, 3.830432449943548*^9}, {
   3.830432579454042*^9, 3.83043269209509*^9}, {3.830432752855376*^9, 
   3.8304327701501417`*^9}, 3.8304330346805277`*^9, {3.8304331052897*^9, 
   3.8304331343226023`*^9}, {3.830434248139089*^9, 3.830434264709237*^9}, {
   3.968156964649576*^9, 3.968156978605952*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"775569dc-8a32-4675-b6dd-56ba651f0f68"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Calculating intersection over union (IoU)", "Section",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771091367329028*^9, 3.771091376051399*^9}, {
   3.771091414565285*^9, 3.771091444641539*^9}, {3.771260575359153*^9, 
   3.7712605976968555`*^9}, 3.771339669102623*^9, 3.771340101690852*^9, {
   3.7728869631343184`*^9, 3.772886969101666*^9}, {3.779194429474598*^9, 
   3.779194447677559*^9}, {3.8292283320962925`*^9, 
   3.829228332388308*^9}},ExpressionUUID->"7051cad1-f476-4f6b-8e4a-\
9d164d8e9d39"],

Cell[CellGroupData[{

Cell["IoU calculation", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.7712522708240223`*^9}, {3.772982609637575*^9, 3.772982609733349*^9}, {
  3.7856105009416*^9, 3.785610512756326*^9}, {3.785614589994857*^9, 
  3.7856145961496897`*^9}, {3.829136554404423*^9, 
  3.829136581158852*^9}},ExpressionUUID->"9ec7c9c3-8844-4cba-90e8-\
8d449d3f3587"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Importing", " ", "ground", " ", "truth", " ", 
    RowBox[{"images", ".", " ", "Make"}], " ", "sure", " ", "these", " ", 
    "are", " ", "these", " ", "are", " ", "the", " ", "corresponding", " ", 
    "ground", " ", "truth", " ", "images", " ", "for", " ", 
    RowBox[{"segresmult", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imptgt", ",", "imggtfilename"}], "}"}], "=", 
     RowBox[{
      RowBox[{"MapAt", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", "1"}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "@", 
         RowBox[{"ParallelMap", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"imgImportFunc", "[", 
             RowBox[{
             "#", ",", "modeiou", ",", "numrandomiou", ",", 
              "listofpositionsiou"}], "]"}], "&"}], ",", "imptgtdir"}], 
          "]"}]}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{"Null", "\[Rule]", "Nothing"}], "}"}]}]}], ";"}], "//", 
   "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.779195432067013*^9, 3.779195435253674*^9}, {
  3.779195576509387*^9, 3.779195664605611*^9}, {3.779195759903103*^9, 
  3.779195768074435*^9}, {3.829063813159149*^9, 3.829063816099104*^9}, {
  3.968156716611838*^9, 
  3.968156799293*^9}},ExpressionUUID->"bbddf4c5-9303-404d-8d1b-a267282f9b37"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "To", " ", "calculate", " ", "the", " ", "IoU", " ", "we", " ", "only", 
     " ", "need", " ", "the", " ", "ground", " ", "truth", " ", "images", " ",
      "or", " ", 
     RowBox[{"arrays", ".", " ", "This"}], " ", "function", " ", "selects", 
     " ", "the", " ", "ground", " ", "truth", " ", "array", " ", "when", " ", 
     "importing", " ", "data", " ", "in", " ", "the", " ", "form", " ", 
     RowBox[{"ImageData", "[", "image", "]"}]}], "\[Rule]", "gtarray"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"imptgtmod", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "===", "Rule"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "#"}], "]"}], "&"}], ",", 
      "imptgt"}], "]"}]}], ";"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.829735858447075*^9, 3.829735948349329*^9}, 
   3.82973598401212*^9, {3.82973604533294*^9, 3.829736058125752*^9}, {
   3.829736163161205*^9, 3.829736204299223*^9}},
 CellLabel->
  "In[267]:=",ExpressionUUID->"1d344b30-4ee0-4a63-9517-c4b7969598b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Dimensions", " ", "and", " ", "total", " ", "number", " ", "of", " ", 
    "imported", " ", "images", " ", "for", " ", "testing"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"imgdimsgt", "=", 
    RowBox[{"Tally", "[", 
     RowBox[{"ImageDimensions", "/@", "imptgtmod"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"Length", "@", "imptgtmod"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.771163353001513*^9, 3.7711633564618645`*^9}, {
   3.771163941473611*^9, 3.771163973569495*^9}, {3.771177625268775*^9, 
   3.7711776267267857`*^9}, {3.772983168979622*^9, 3.7729831741827173`*^9}, 
   3.828816557410578*^9, {3.829741040877485*^9, 3.829741043356948*^9}, {
   3.829741491085291*^9, 3.8297415103652945`*^9}, {3.86377758092288*^9, 
   3.863777606856961*^9}, {3.8637776640419645`*^9, 3.863777672719855*^9}, 
   3.9681568185732384`*^9},ExpressionUUID->"c6a594e4-d158-4e3b-bfbe-\
e7fad881226a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Display", " ", "of", " ", "imported", " ", "ground", " ", "truth", " ", 
    RowBox[{"images", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"modeiou", "\[Equal]", "\"\<array\>\""}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Manipulate", "[", 
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"ArrayPlot", "[", 
         RowBox[{
          RowBox[{"imptgtmod", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{"Frame", "\[Rule]", "None"}]}], "]"}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "@", "imptgtmod"}], ",", "1"}], "}"}], ",", 
      RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Manipulate", "[", 
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"imptgtmod", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "@", "imptgtmod"}], ",", "1"}], "}"}], ",", 
      RowBox[{"ControlPlacement", "\[Rule]", "Top"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.77946303416492*^9, 3.7794630514506655`*^9}, {
   3.7794632207459803`*^9, 3.7794632278369856`*^9}, {3.829059116104451*^9, 
   3.829059126716881*^9}, {3.829064080675031*^9, 3.82906416947816*^9}, 
   3.829064230782892*^9, {3.8297359933175335`*^9, 3.829736005551614*^9}, {
   3.8297362988417854`*^9, 3.82973630407902*^9}, {3.863788316252137*^9, 
   3.8637883162953815`*^9}, {3.9681568256890717`*^9, 
   3.968156838455839*^9}},ExpressionUUID->"4e047622-580c-4d98-a775-\
ec669ad94caf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Printing", " ", "imported", " ", "file", " ", "names"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"filenamelistiou", "=", 
     RowBox[{"TakeList", "[", 
      RowBox[{
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"First", "@", "#2"}], "\[Rule]", "#1"}], "&"}], ",", 
         RowBox[{"Flatten", "@", "imggtfilename"}]}], "]"}], ",", 
       RowBox[{"Length", "/@", "imggtfilename"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Dataset", "@", 
    RowBox[{"Association", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", "\[Rule]", "#2"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"FileNameTake", "[", 
            RowBox[{"#", ",", 
             RowBox[{"-", "2"}]}], "]"}], "&"}], "/@", "imptgtdir"}], ",", 
         RowBox[{"Map", "[", 
          RowBox[{"Association", ",", 
           RowBox[{"MapAt", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"FileNameTake", "[", 
               RowBox[{"#", ",", 
                RowBox[{"-", "2"}]}], "]"}], "&"}], ",", "filenamelistiou", 
             ",", 
             RowBox[{"{", 
              RowBox[{"All", ",", "All", ",", "2"}], "}"}]}], "]"}]}], 
          "]"}]}], "}"}]}], "]"}], "]"}]}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.7711636695277295`*^9, 3.771163670903144*^9}, {
   3.771163722942408*^9, 3.771163746992789*^9}, {3.7712472024880185`*^9, 
   3.771247239088815*^9}, {3.771601430127118*^9, 3.7716014419155455`*^9}, 
   3.7716014750014677`*^9, {3.77919586033961*^9, 3.7791959043905153`*^9}, 
   3.77919603533014*^9, {3.78568696918363*^9, 3.7856869744483633`*^9}, {
   3.968156843014458*^9, 
   3.968156853666411*^9}},ExpressionUUID->"012ca307-b66b-41db-9bda-\
db0b86231645"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Computes", " ", "intersection", " ", "over", " ", "union", " ", 
    RowBox[{"metric", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"iouresmulti", "=", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"calcIoUMulti", "[", 
         RowBox[{
          RowBox[{"Image", "@", "#1"}], ",", "#2", ",", "cropsegmultimgs", 
          ",", "userulechangeIoU", ",", "newclassindex"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"imptgtmod", ",", "segresmult"}], "}"}]}], "]"}]}], ";"}], "//",
    "AbsoluteTiming"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.779196088402685*^9, 3.779196194437172*^9}, {
   3.7792090822398868`*^9, 3.77920913361811*^9}, 3.779212320564161*^9, {
   3.7792128420891275`*^9, 3.779212843149291*^9}, {3.779462472730695*^9, 
   3.779462479533505*^9}, {3.779462789848223*^9, 3.779462823560073*^9}, {
   3.779462857202144*^9, 3.7794629553107877`*^9}, {3.779463107227545*^9, 
   3.779463121828499*^9}, {3.785611256630288*^9, 3.785611325852496*^9}, {
   3.785611363078758*^9, 3.785611371842087*^9}, {3.785611484977784*^9, 
   3.785611485336858*^9}, {3.785612252014745*^9, 3.785612271731868*^9}, {
   3.785612625298373*^9, 3.78561264682392*^9}, {3.785614234512121*^9, 
   3.7856143147464676`*^9}, {3.785614352347539*^9, 3.785614468400205*^9}, {
   3.787927027618256*^9, 3.78792704077359*^9}, {3.8291318604506016`*^9, 
   3.829131885657948*^9}, {3.829131917444323*^9, 3.829131978640004*^9}, 
   3.8291320460585494`*^9, 3.829133994061319*^9, 3.829744220144377*^9, {
   3.829827784556477*^9, 3.829827786362678*^9}, {3.863778671371545*^9, 
   3.863778679861387*^9}, {3.863780307475149*^9, 3.8637803209784985`*^9}, 
   3.863780674963662*^9, {3.863781070832715*^9, 3.863781081546564*^9}, {
   3.8637821805722466`*^9, 3.863782203277215*^9}, 3.9647984862777653`*^9, {
   3.9681568581931076`*^9, 
   3.968156880172962*^9}},ExpressionUUID->"d143541f-fede-4926-8097-\
2f15ebd7e115"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Tabular", " ", "results"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"iouresultlist", "=", 
     RowBox[{"tablePrepFunc", "[", 
      RowBox[{"iouresmulti", ",", "imggtfilename"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"TableForm", "[", 
    RowBox[{"iouresultlist", ",", 
     RowBox[{"TableAlignments", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Left", ",", "Center"}], "}"}]}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.785614482176613*^9, 3.785614512761922*^9}, {
   3.788114263870211*^9, 3.788114315919286*^9}, {3.829133976861024*^9, 
   3.829134011531641*^9}, {3.829134246547045*^9, 3.829134256258566*^9}, {
   3.829134562094054*^9, 3.829134578235482*^9}, {3.829134695155459*^9, 
   3.82913469606264*^9}, {3.829751512864873*^9, 3.829751536180988*^9}, {
   3.829756976289227*^9, 3.829756978470224*^9}, 3.82975788479503*^9, 
   3.829757934821998*^9, {3.829758147850481*^9, 3.829758160450739*^9}, {
   3.829823141902969*^9, 3.82982316018193*^9}, {3.8298272259975276`*^9, 
   3.829827237263589*^9}, {3.829827270947987*^9, 3.829827272086976*^9}, {
   3.829827724735345*^9, 3.829827740487144*^9}, {3.968156875725786*^9, 
   3.9681568951542397`*^9}},ExpressionUUID->"2579661a-7f31-4d19-80c0-\
24c79d950db9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"IoU", " ", "value", " ", "histogram", " ", "by", " ", 
    RowBox[{"class", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"histplot", "=", 
   RowBox[{"Histogram", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"classioulist", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"First", ",", "iouresmulti"}], "]"}], "]"}], "/.", 
        RowBox[{"_String", "\[Rule]", "Nothing"}]}]}], ")"}], ",", 
     RowBox[{"{", "0.02", "}"}], ",", "\"\<Probability\>\"", ",", 
     RowBox[{"ChartLayout", "\[Rule]", "\"\<Stacked\>\""}], ",", 
     RowBox[{"ChartStyle", "\[Rule]", "classcolor"}], ",", 
     RowBox[{"ChartLegends", "\[Rule]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"\"\<Class \>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "classioulist", "]"}]}], "}"}]}], "]"}]}], 
     ",", 
     RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
     RowBox[{"Background", "\[Rule]", "None"}]}], "]"}]}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.829827849595727*^9, 3.829827852467779*^9}, 
   3.829828076722614*^9, {3.829828156208829*^9, 3.829828185139818*^9}, {
   3.829828220281441*^9, 3.829828237275811*^9}, {3.829828278551149*^9, 
   3.829828413449904*^9}, {3.829828493066151*^9, 3.829828554018116*^9}, {
   3.829828594455055*^9, 3.8298285998808727`*^9}, {3.8298287357253304`*^9, 
   3.829828746405079*^9}, {3.8298288574577026`*^9, 3.829828860960181*^9}, {
   3.8298290325134583`*^9, 3.8298290402652197`*^9}, {3.8298290771902437`*^9, 
   3.829829095729588*^9}, {3.829829191721179*^9, 3.8298292074242487`*^9}, {
   3.829829299000063*^9, 3.829829340010844*^9}, {3.829829455646717*^9, 
   3.829829480191402*^9}, {3.829829559064161*^9, 3.8298295601393156`*^9}, {
   3.829829637375721*^9, 3.829829648006922*^9}, {3.829829691914821*^9, 
   3.8298298239705124`*^9}, {3.829829907230468*^9, 3.8298299248403187`*^9}, {
   3.829829962371917*^9, 3.829830067337103*^9}, {3.863788591866003*^9, 
   3.863788652938794*^9}, 3.9659239375683975`*^9, {3.968156898753338*^9, 
   3.968156922296553*^9}},ExpressionUUID->"67756369-0575-494f-bc7f-\
d40e3695a38d"]
}, Closed]],

Cell[CellGroupData[{

Cell["IoU data export", "Subsection",
 Editable->False,
 Deletable->False,
 Evaluatable->False,
 CellChangeTimes->{{3.771006780822073*^9, 3.771006807572807*^9}, {
  3.7710069593680377`*^9, 3.7710069600866213`*^9}, {3.771250713466589*^9, 
  3.771250719464949*^9}, {3.771250780544627*^9, 3.7712508371238327`*^9}, {
  3.7712512798242598`*^9, 3.771251317346944*^9}, {3.771252137807319*^9, 
  3.7712522708240223`*^9}, {3.772982609637575*^9, 3.772982609733349*^9}, {
  3.7856105009416*^9, 3.785610512756326*^9}, {3.785614589994857*^9, 
  3.7856145961496897`*^9}},ExpressionUUID->"07099a9f-6799-471a-8944-\
a0c5ae870ade"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Export", " ", "IoU", " ", "data"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"dataExport", "[", 
   RowBox[{"iouresultlist", ",", "iouexppath", ",", "ioufilename"}], 
   "]"}]}]], "Input",
 Editable->False,
 Deletable->False,
 Evaluatable->True,
 CellChangeTimes->{{3.785614706380454*^9, 3.785614782239549*^9}, {
   3.785614998755457*^9, 3.78561499963023*^9}, {3.785687125459268*^9, 
   3.7856871316922035`*^9}, 3.785687173817554*^9, 3.787926386206196*^9, {
   3.787926452795326*^9, 3.787926477621724*^9}, {3.968156932485855*^9, 
   3.968156940014082*^9}},ExpressionUUID->"c982e8f0-83bc-4a31-b519-\
0dcf65e3418a"]
}, Closed]]
}, Open  ]]
},
WindowSize->{821.1428571428571, 852},
WindowMargins->{{-4.285714285714286, Automatic}, {Automatic, 0}},
ShowCellTags->True,
FrontEndVersion->"14.0 for Microsoft Windows (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"99d31989-dc35-4457-ba7c-490f8d3dab2d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 615, 11, 50, "Section",ExpressionUUID->"31d44873-effb-441a-97bb-78de20879e79",
 Evaluatable->False],
Cell[CellGroupData[{
Cell[1220, 37, 280, 7, 41, "Subsection",ExpressionUUID->"ae715c53-d28e-4945-82c5-415b1db9cabf",
 Evaluatable->False],
Cell[1503, 46, 2070, 55, 50, "Input",ExpressionUUID->"cd94e952-7a67-4721-8627-59907ae90e65",
 Evaluatable->True],
Cell[3576, 103, 513, 11, 21, "Input",ExpressionUUID->"393438be-77f4-48ec-b621-8986cbb3dcba",
 Evaluatable->True],
Cell[4092, 116, 2137, 36, 36, "Input",ExpressionUUID->"9c200a65-5f0a-430b-867f-39baac0ace8c",
 Evaluatable->True],
Cell[6232, 154, 898, 21, 36, "Input",ExpressionUUID->"c849884c-1ef4-4160-a0fa-ba16c06e690e",
 Evaluatable->True],
Cell[7133, 177, 1001, 22, 36, "Input",ExpressionUUID->"e08d260f-e4e1-4daf-870d-c7bf43484107",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[8171, 204, 220, 6, 41, "Subsection",ExpressionUUID->"69f13470-c74d-4498-ae19-1f60a787a498",
 Evaluatable->False],
Cell[8394, 212, 405, 10, 33, "Input",ExpressionUUID->"501fcad8-3315-4650-8d2c-0f5ce9e7268f",
 Evaluatable->True,
 InitializationCell->True]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[8848, 228, 790, 14, 40, "Section",ExpressionUUID->"ba51696a-19fb-4322-afb5-95379d68e6ad",
 Evaluatable->False],
Cell[CellGroupData[{
Cell[9663, 246, 427, 9, 41, "Subsection",ExpressionUUID->"0df258a7-09fa-438f-aa5b-fc461b98f583",
 Evaluatable->False],
Cell[10093, 257, 1492, 31, 50, "Input",ExpressionUUID->"25cba8f5-3c4f-4ab0-b8ef-610401d8cef0",
 Evaluatable->True],
Cell[11588, 290, 3734, 81, 164, "Input",ExpressionUUID->"bcd0adbf-2571-4512-8789-e3f43f57abeb",
 Evaluatable->True],
Cell[15325, 373, 1232, 32, 50, "Input",ExpressionUUID->"936c6edd-d76b-8b4b-aa7d-6fc8c8383044",
 Evaluatable->True],
Cell[16560, 407, 1997, 40, 50, "Input",ExpressionUUID->"df3d0f47-e28a-4fd2-8658-4c63e5acaeac",
 Evaluatable->True],
Cell[18560, 449, 3000, 79, 93, "Input",ExpressionUUID->"cd5d9996-ff7e-534c-abb7-dc481009d558",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[21597, 533, 238, 6, 30, "Subsection",ExpressionUUID->"e1f4fa57-c4ed-491f-abc5-cbd4b32a483e",
 Evaluatable->False],
Cell[21838, 541, 823, 23, 36, "Input",ExpressionUUID->"a3fabd4a-0b43-5841-a83d-c63dd19f60f8",
 Evaluatable->True],
Cell[22664, 566, 1278, 26, 64, "Input",ExpressionUUID->"56a59599-03df-6543-b31f-6ec14c746738",
 Evaluatable->True],
Cell[23945, 594, 612, 16, 36, "Input",ExpressionUUID->"00ccc7a7-73b2-b34f-9c28-40f363d9e843",
 Evaluatable->True],
Cell[24560, 612, 3014, 62, 93, "Input",ExpressionUUID->"10ec0547-b76f-4063-ac11-555c5cd95515",
 Evaluatable->True],
Cell[27577, 676, 1260, 23, 36, "Input",ExpressionUUID->"ab8f7267-245f-4a36-b576-f9af129e2215",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[28874, 704, 414, 9, 30, "Subsection",ExpressionUUID->"4ed86300-6a56-46b2-9489-f9f9bf9f074b",
 Evaluatable->False],
Cell[29291, 715, 1100, 29, 50, "Input",ExpressionUUID->"bb69c5f8-4f86-483f-b6f4-f0e3d4f12282",
 Evaluatable->True],
Cell[30394, 746, 3506, 60, 50, "Input",ExpressionUUID->"f2b0e368-6253-4f2b-911e-7f921111dcfb",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[33937, 811, 271, 7, 30, "Subsection",ExpressionUUID->"9dad18ab-ba08-406e-acde-95926f384d63",
 Evaluatable->False],
Cell[34211, 820, 3378, 65, 164, "Input",ExpressionUUID->"179c10c4-8e94-483d-9e33-ac8e1266875d",
 Evaluatable->True],
Cell[37592, 887, 6938, 105, 93, "Input",ExpressionUUID->"6038096b-0bbf-4ac7-8050-6c51d2e627e9",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[44567, 997, 625, 11, 30, "Subsection",ExpressionUUID->"70d0a307-fd29-4c9c-88e6-722a718540b8",
 Evaluatable->False],
Cell[45195, 1010, 2000, 40, 64, "Input",ExpressionUUID->"cc5b2e17-071f-467b-abb8-99bdaee69571",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[47232, 1055, 334, 7, 30, "Subsection",ExpressionUUID->"e1de85eb-219e-493b-8101-21b4ead3aa90",
 Evaluatable->False],
Cell[47569, 1064, 1268, 31, 50, "Input",ExpressionUUID->"38192e42-7d27-4de9-8f96-4e6e33b0476c",
 Evaluatable->True],
Cell[48840, 1097, 2581, 45, 79, "Input",ExpressionUUID->"076cb38a-ec09-4ab3-8121-de9ceb897ac5",
 Evaluatable->True],
Cell[51424, 1144, 1177, 24, 50, "Input",ExpressionUUID->"9f4e1f2a-19dc-4f34-b1cd-1be7ac3a9c49",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[52638, 1173, 485, 8, 30, "Subsection",ExpressionUUID->"491586d0-cf64-4c24-8153-4f44f98baf94",
 Evaluatable->False],
Cell[53126, 1183, 730, 17, 36, "Input",ExpressionUUID->"c5e48330-157d-4082-86cb-09da50fc117c",
 Evaluatable->True],
Cell[53859, 1202, 690, 17, 36, "Input",ExpressionUUID->"e40c1470-09d7-4c5a-b216-764457a2acb4",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[54586, 1224, 625, 11, 30, "Subsection",ExpressionUUID->"fa28effe-9d00-45e0-b785-5d2de8ea9ce0",
 Evaluatable->False],
Cell[55214, 1237, 899, 20, 50, "Input",ExpressionUUID->"4b2a4fdf-4afb-4db3-a52d-c1d45cdb8482",
 Evaluatable->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[56162, 1263, 507, 10, 50, "Section",ExpressionUUID->"22a2149f-8659-48d1-893e-b6857c94950c",
 Evaluatable->False],
Cell[CellGroupData[{
Cell[56694, 1277, 242, 6, 41, "Subsection",ExpressionUUID->"6a0f6666-1697-4977-afc0-3b0275494c45",
 Evaluatable->False],
Cell[56939, 1285, 1012, 24, 50, "Input",ExpressionUUID->"2978ff21-156b-4ac7-8b7a-e5df72fcc212",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[57988, 1314, 673, 12, 30, "Subsection",ExpressionUUID->"7b39a684-06d0-4629-9cc0-675ae841fa4f",
 Evaluatable->False],
Cell[58664, 1328, 1278, 27, 36, "Input",ExpressionUUID->"c18b66ac-cdc7-45f6-a8c1-180ba5ad1b65",
 Evaluatable->True],
Cell[59945, 1357, 952, 18, 36, "Input",ExpressionUUID->"68450152-286d-40bf-8628-df197ef53631",
 Evaluatable->True],
Cell[60900, 1377, 1227, 31, 79, "Input",ExpressionUUID->"128f6653-9abb-45ff-bb29-919730b8b2c4",
 Evaluatable->True],
Cell[62130, 1410, 1250, 32, 50, "Input",ExpressionUUID->"576b8f66-0e5c-4343-93d7-e751903e5c90",
 Evaluatable->True],
Cell[63383, 1444, 908, 21, 50, "Input",ExpressionUUID->"c7660823-4253-4f5f-9f63-696f7193d586",
 Evaluatable->True],
Cell[64294, 1467, 2645, 65, 107, "Input",ExpressionUUID->"5cc55931-374b-402a-84ed-5d1e8bd1bda8",
 Evaluatable->True],
Cell[66942, 1534, 806, 21, 50, "Input",ExpressionUUID->"a994b4d4-1bd1-c044-8b0b-f2f50233cc7a",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[67785, 1560, 575, 11, 30, "Subsection",ExpressionUUID->"127decb5-2322-4519-bd07-a0db9f6ecd21",
 Evaluatable->False],
Cell[68363, 1573, 1746, 39, 64, "Input",ExpressionUUID->"cd005c2e-f7d0-45b7-906d-0d3c4a94931e",
 Evaluatable->True],
Cell[70112, 1614, 1065, 22, 50, "Input",ExpressionUUID->"810ccdf7-9aec-4954-9059-f60fc78f663f",
 Evaluatable->True],
Cell[71180, 1638, 2380, 43, 79, "Input",ExpressionUUID->"baa51930-bf62-4cd7-8b06-71b160424ed7",
 Evaluatable->True],
Cell[73563, 1683, 2061, 38, 93, "Input",ExpressionUUID->"36d05ad3-37b3-4d82-8e5b-76b27cb65f73",
 Evaluatable->True],
Cell[75627, 1723, 3355, 67, 164, "Input",ExpressionUUID->"ca009f7f-3b54-4b32-82c4-de99678303f8",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[79019, 1795, 583, 11, 30, "Subsection",ExpressionUUID->"4191e48c-32f2-4119-83f6-6e63b1839932",
 Evaluatable->False],
Cell[79605, 1808, 1146, 28, 64, "Input",ExpressionUUID->"4f32df0e-6fdb-4d59-93bf-23aa35691b82",
 Evaluatable->True],
Cell[80754, 1838, 1200, 26, 50, "Input",ExpressionUUID->"6fc9b9d7-e5e7-4e7c-a9d9-bdc0170e605a",
 Evaluatable->True],
Cell[81957, 1866, 1194, 26, 50, "Input",ExpressionUUID->"e9ab29b0-81d5-48a9-b2ec-dabe0bf74c8c",
 Evaluatable->True],
Cell[83154, 1894, 2312, 50, 122, "Input",ExpressionUUID->"58c43e1d-5ac1-4e8d-bc7c-7863634c7346",
 Evaluatable->True],
Cell[85469, 1946, 3183, 71, 150, "Input",ExpressionUUID->"109adba5-345d-4bf6-9614-fa527749fbd1",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[88689, 2022, 628, 15, 30, "Subsection",ExpressionUUID->"3e521865-925f-47ea-871a-1c64e3ea3ebd",
 Evaluatable->False],
Cell[89320, 2039, 802, 20, 36, "Input",ExpressionUUID->"00f6ed7a-44eb-4e14-864f-da3a080d0839",
 Evaluatable->True],
Cell[90125, 2061, 1314, 29, 36, "Input",ExpressionUUID->"775569dc-8a32-4675-b6dd-56ba651f0f68",
 Evaluatable->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[91488, 2096, 541, 10, 50, "Section",ExpressionUUID->"7051cad1-f476-4f6b-8e4a-9d164d8e9d39",
 Evaluatable->False],
Cell[CellGroupData[{
Cell[92054, 2110, 663, 12, 41, "Subsection",ExpressionUUID->"9ec7c9c3-8844-4cba-90e8-8d449d3f3587",
 Evaluatable->False],
Cell[92720, 2124, 1543, 39, 107, "Input",ExpressionUUID->"bbddf4c5-9303-404d-8d1b-a267282f9b37",
 Evaluatable->True],
Cell[94266, 2165, 1274, 32, 64, "Input",ExpressionUUID->"1d344b30-4ee0-4a63-9517-c4b7969598b8",
 Evaluatable->True],
Cell[95543, 2199, 1017, 23, 50, "Input",ExpressionUUID->"c6a594e4-d158-4e3b-bfbe-e7fad881226a",
 Evaluatable->True],
Cell[96563, 2224, 1927, 47, 107, "Input",ExpressionUUID->"4e047622-580c-4d98-a775-ec669ad94caf",
 Evaluatable->True],
Cell[98493, 2273, 1986, 53, 107, "Input",ExpressionUUID->"012ca307-b66b-41db-9bda-db0b86231645",
 Evaluatable->True],
Cell[100482, 2328, 2061, 40, 64, "Input",ExpressionUUID->"d143541f-fede-4926-8097-2f15ebd7e115",
 Evaluatable->True],
Cell[102546, 2370, 1367, 29, 50, "Input",ExpressionUUID->"2579661a-7f31-4d19-80c0-24c79d950db9",
 Evaluatable->True],
Cell[103916, 2401, 2325, 47, 93, "Input",ExpressionUUID->"67756369-0575-494f-bc7f-d40e3695a38d",
 Evaluatable->True]
}, Closed]],
Cell[CellGroupData[{
Cell[106278, 2453, 614, 11, 30, "Subsection",ExpressionUUID->"07099a9f-6799-471a-8944-a0c5ae870ade",
 Evaluatable->False],
Cell[106895, 2466, 667, 15, 36, "Input",ExpressionUUID->"c982e8f0-83bc-4a31-b519-0dcf65e3418a",
 Evaluatable->True]
}, Closed]]
}, Open  ]]
}
]
*)

